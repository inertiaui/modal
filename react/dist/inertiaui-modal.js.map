{"version":3,"file":"inertiaui-modal.js","sources":["../../vue/src/config.ts","../node_modules/react/cjs/react-jsx-runtime.production.js","../node_modules/react/cjs/react-jsx-runtime.development.js","../node_modules/react/jsx-runtime.js","../../vue/src/helpers.ts","../src/ModalRoot.tsx","../src/ModalRenderer.tsx","../src/useModal.ts","../src/Deferred.tsx","../src/HeadlessModal.tsx","../src/CloseButton.tsx","../node_modules/clsx/dist/clsx.mjs","../../vue/src/constants.ts","../src/ModalContent.tsx","../src/SlideoverContent.tsx","../src/Modal.tsx","../src/ModalLink.tsx","../src/WhenVisible.tsx","../src/inertiauiModal.ts"],"sourcesContent":["export interface ModalTypeConfig {\n    closeButton: boolean\n    closeExplicitly: boolean\n    closeOnClickOutside: boolean\n    maxWidth: string\n    paddingClasses: string\n    panelClasses: string\n    position: string\n}\n\nexport interface ModalConfig {\n    type: 'modal' | 'slideover'\n    navigate: boolean\n    useNativeDialog: boolean\n    modal: ModalTypeConfig\n    slideover: ModalTypeConfig\n}\n\nconst defaultConfig: ModalConfig = {\n    type: 'modal',\n    navigate: false,\n    useNativeDialog: true,\n    modal: {\n        closeButton: true,\n        closeExplicitly: false,\n        closeOnClickOutside: true,\n        maxWidth: '2xl',\n        paddingClasses: 'p-4 sm:p-6',\n        panelClasses: 'bg-white rounded',\n        position: 'center',\n    },\n    slideover: {\n        closeButton: true,\n        closeExplicitly: false,\n        closeOnClickOutside: true,\n        maxWidth: 'md',\n        paddingClasses: 'p-4 sm:p-6',\n        panelClasses: 'bg-white min-h-screen',\n        position: 'right',\n    },\n}\n\nclass Config {\n    private config: ModalConfig\n\n    constructor() {\n        this.config = {} as ModalConfig\n        this.reset()\n    }\n\n    reset(): void {\n        this.config = JSON.parse(JSON.stringify(defaultConfig))\n    }\n\n    put(key: string | Partial<ModalConfig>, value?: unknown): void {\n        if (typeof key === 'object') {\n            this.config = {\n                type: key.type ?? defaultConfig.type,\n                navigate: key.navigate ?? defaultConfig.navigate,\n                useNativeDialog: key.useNativeDialog ?? defaultConfig.useNativeDialog,\n                modal: { ...defaultConfig.modal, ...(key.modal ?? {}) },\n                slideover: { ...defaultConfig.slideover, ...(key.slideover ?? {}) },\n            }\n            return\n        }\n        const keys = key.split('.')\n        let current: Record<string, unknown> = this.config as unknown as Record<string, unknown>\n        for (let i = 0; i < keys.length - 1; i++) {\n            current = (current[keys[i]] = current[keys[i]] || {}) as Record<string, unknown>\n        }\n        current[keys[keys.length - 1]] = value\n    }\n\n    get(key?: string): unknown {\n        if (typeof key === 'undefined') {\n            return this.config\n        }\n        const keys = key.split('.')\n        let current: unknown = this.config\n        for (const k of keys) {\n            if (current === null || current === undefined || typeof current !== 'object') {\n                return null\n            }\n            current = (current as Record<string, unknown>)[k]\n        }\n        return current === undefined ? null : current\n    }\n}\n\nconst configInstance = new Config()\n\nexport const resetConfig = (): void => configInstance.reset()\nexport const putConfig = (key: string | Partial<ModalConfig>, value?: unknown): void => configInstance.put(key, value)\nexport const getConfig = (key?: string): unknown => configInstance.get(key)\nexport const getConfigByType = (isSlideover: boolean, key: string): unknown =>\n    configInstance.get(isSlideover ? `slideover.${key}` : `modal.${key}`)\n","/**\n * @license React\n * react-jsx-runtime.production.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\nvar REACT_ELEMENT_TYPE = Symbol.for(\"react.transitional.element\"),\n  REACT_FRAGMENT_TYPE = Symbol.for(\"react.fragment\");\nfunction jsxProd(type, config, maybeKey) {\n  var key = null;\n  void 0 !== maybeKey && (key = \"\" + maybeKey);\n  void 0 !== config.key && (key = \"\" + config.key);\n  if (\"key\" in config) {\n    maybeKey = {};\n    for (var propName in config)\n      \"key\" !== propName && (maybeKey[propName] = config[propName]);\n  } else maybeKey = config;\n  config = maybeKey.ref;\n  return {\n    $$typeof: REACT_ELEMENT_TYPE,\n    type: type,\n    key: key,\n    ref: void 0 !== config ? config : null,\n    props: maybeKey\n  };\n}\nexports.Fragment = REACT_FRAGMENT_TYPE;\nexports.jsx = jsxProd;\nexports.jsxs = jsxProd;\n","/**\n * @license React\n * react-jsx-runtime.development.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\n\"production\" !== process.env.NODE_ENV &&\n  (function () {\n    function getComponentNameFromType(type) {\n      if (null == type) return null;\n      if (\"function\" === typeof type)\n        return type.$$typeof === REACT_CLIENT_REFERENCE\n          ? null\n          : type.displayName || type.name || null;\n      if (\"string\" === typeof type) return type;\n      switch (type) {\n        case REACT_FRAGMENT_TYPE:\n          return \"Fragment\";\n        case REACT_PROFILER_TYPE:\n          return \"Profiler\";\n        case REACT_STRICT_MODE_TYPE:\n          return \"StrictMode\";\n        case REACT_SUSPENSE_TYPE:\n          return \"Suspense\";\n        case REACT_SUSPENSE_LIST_TYPE:\n          return \"SuspenseList\";\n        case REACT_ACTIVITY_TYPE:\n          return \"Activity\";\n      }\n      if (\"object\" === typeof type)\n        switch (\n          (\"number\" === typeof type.tag &&\n            console.error(\n              \"Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue.\"\n            ),\n          type.$$typeof)\n        ) {\n          case REACT_PORTAL_TYPE:\n            return \"Portal\";\n          case REACT_CONTEXT_TYPE:\n            return type.displayName || \"Context\";\n          case REACT_CONSUMER_TYPE:\n            return (type._context.displayName || \"Context\") + \".Consumer\";\n          case REACT_FORWARD_REF_TYPE:\n            var innerType = type.render;\n            type = type.displayName;\n            type ||\n              ((type = innerType.displayName || innerType.name || \"\"),\n              (type = \"\" !== type ? \"ForwardRef(\" + type + \")\" : \"ForwardRef\"));\n            return type;\n          case REACT_MEMO_TYPE:\n            return (\n              (innerType = type.displayName || null),\n              null !== innerType\n                ? innerType\n                : getComponentNameFromType(type.type) || \"Memo\"\n            );\n          case REACT_LAZY_TYPE:\n            innerType = type._payload;\n            type = type._init;\n            try {\n              return getComponentNameFromType(type(innerType));\n            } catch (x) {}\n        }\n      return null;\n    }\n    function testStringCoercion(value) {\n      return \"\" + value;\n    }\n    function checkKeyStringCoercion(value) {\n      try {\n        testStringCoercion(value);\n        var JSCompiler_inline_result = !1;\n      } catch (e) {\n        JSCompiler_inline_result = !0;\n      }\n      if (JSCompiler_inline_result) {\n        JSCompiler_inline_result = console;\n        var JSCompiler_temp_const = JSCompiler_inline_result.error;\n        var JSCompiler_inline_result$jscomp$0 =\n          (\"function\" === typeof Symbol &&\n            Symbol.toStringTag &&\n            value[Symbol.toStringTag]) ||\n          value.constructor.name ||\n          \"Object\";\n        JSCompiler_temp_const.call(\n          JSCompiler_inline_result,\n          \"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.\",\n          JSCompiler_inline_result$jscomp$0\n        );\n        return testStringCoercion(value);\n      }\n    }\n    function getTaskName(type) {\n      if (type === REACT_FRAGMENT_TYPE) return \"<>\";\n      if (\n        \"object\" === typeof type &&\n        null !== type &&\n        type.$$typeof === REACT_LAZY_TYPE\n      )\n        return \"<...>\";\n      try {\n        var name = getComponentNameFromType(type);\n        return name ? \"<\" + name + \">\" : \"<...>\";\n      } catch (x) {\n        return \"<...>\";\n      }\n    }\n    function getOwner() {\n      var dispatcher = ReactSharedInternals.A;\n      return null === dispatcher ? null : dispatcher.getOwner();\n    }\n    function UnknownOwner() {\n      return Error(\"react-stack-top-frame\");\n    }\n    function hasValidKey(config) {\n      if (hasOwnProperty.call(config, \"key\")) {\n        var getter = Object.getOwnPropertyDescriptor(config, \"key\").get;\n        if (getter && getter.isReactWarning) return !1;\n      }\n      return void 0 !== config.key;\n    }\n    function defineKeyPropWarningGetter(props, displayName) {\n      function warnAboutAccessingKey() {\n        specialPropKeyWarningShown ||\n          ((specialPropKeyWarningShown = !0),\n          console.error(\n            \"%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)\",\n            displayName\n          ));\n      }\n      warnAboutAccessingKey.isReactWarning = !0;\n      Object.defineProperty(props, \"key\", {\n        get: warnAboutAccessingKey,\n        configurable: !0\n      });\n    }\n    function elementRefGetterWithDeprecationWarning() {\n      var componentName = getComponentNameFromType(this.type);\n      didWarnAboutElementRef[componentName] ||\n        ((didWarnAboutElementRef[componentName] = !0),\n        console.error(\n          \"Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.\"\n        ));\n      componentName = this.props.ref;\n      return void 0 !== componentName ? componentName : null;\n    }\n    function ReactElement(type, key, props, owner, debugStack, debugTask) {\n      var refProp = props.ref;\n      type = {\n        $$typeof: REACT_ELEMENT_TYPE,\n        type: type,\n        key: key,\n        props: props,\n        _owner: owner\n      };\n      null !== (void 0 !== refProp ? refProp : null)\n        ? Object.defineProperty(type, \"ref\", {\n            enumerable: !1,\n            get: elementRefGetterWithDeprecationWarning\n          })\n        : Object.defineProperty(type, \"ref\", { enumerable: !1, value: null });\n      type._store = {};\n      Object.defineProperty(type._store, \"validated\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: 0\n      });\n      Object.defineProperty(type, \"_debugInfo\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: null\n      });\n      Object.defineProperty(type, \"_debugStack\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: debugStack\n      });\n      Object.defineProperty(type, \"_debugTask\", {\n        configurable: !1,\n        enumerable: !1,\n        writable: !0,\n        value: debugTask\n      });\n      Object.freeze && (Object.freeze(type.props), Object.freeze(type));\n      return type;\n    }\n    function jsxDEVImpl(\n      type,\n      config,\n      maybeKey,\n      isStaticChildren,\n      debugStack,\n      debugTask\n    ) {\n      var children = config.children;\n      if (void 0 !== children)\n        if (isStaticChildren)\n          if (isArrayImpl(children)) {\n            for (\n              isStaticChildren = 0;\n              isStaticChildren < children.length;\n              isStaticChildren++\n            )\n              validateChildKeys(children[isStaticChildren]);\n            Object.freeze && Object.freeze(children);\n          } else\n            console.error(\n              \"React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.\"\n            );\n        else validateChildKeys(children);\n      if (hasOwnProperty.call(config, \"key\")) {\n        children = getComponentNameFromType(type);\n        var keys = Object.keys(config).filter(function (k) {\n          return \"key\" !== k;\n        });\n        isStaticChildren =\n          0 < keys.length\n            ? \"{key: someKey, \" + keys.join(\": ..., \") + \": ...}\"\n            : \"{key: someKey}\";\n        didWarnAboutKeySpread[children + isStaticChildren] ||\n          ((keys =\n            0 < keys.length ? \"{\" + keys.join(\": ..., \") + \": ...}\" : \"{}\"),\n          console.error(\n            'A props object containing a \"key\" prop is being spread into JSX:\\n  let props = %s;\\n  <%s {...props} />\\nReact keys must be passed directly to JSX without using spread:\\n  let props = %s;\\n  <%s key={someKey} {...props} />',\n            isStaticChildren,\n            children,\n            keys,\n            children\n          ),\n          (didWarnAboutKeySpread[children + isStaticChildren] = !0));\n      }\n      children = null;\n      void 0 !== maybeKey &&\n        (checkKeyStringCoercion(maybeKey), (children = \"\" + maybeKey));\n      hasValidKey(config) &&\n        (checkKeyStringCoercion(config.key), (children = \"\" + config.key));\n      if (\"key\" in config) {\n        maybeKey = {};\n        for (var propName in config)\n          \"key\" !== propName && (maybeKey[propName] = config[propName]);\n      } else maybeKey = config;\n      children &&\n        defineKeyPropWarningGetter(\n          maybeKey,\n          \"function\" === typeof type\n            ? type.displayName || type.name || \"Unknown\"\n            : type\n        );\n      return ReactElement(\n        type,\n        children,\n        maybeKey,\n        getOwner(),\n        debugStack,\n        debugTask\n      );\n    }\n    function validateChildKeys(node) {\n      isValidElement(node)\n        ? node._store && (node._store.validated = 1)\n        : \"object\" === typeof node &&\n          null !== node &&\n          node.$$typeof === REACT_LAZY_TYPE &&\n          (\"fulfilled\" === node._payload.status\n            ? isValidElement(node._payload.value) &&\n              node._payload.value._store &&\n              (node._payload.value._store.validated = 1)\n            : node._store && (node._store.validated = 1));\n    }\n    function isValidElement(object) {\n      return (\n        \"object\" === typeof object &&\n        null !== object &&\n        object.$$typeof === REACT_ELEMENT_TYPE\n      );\n    }\n    var React = require(\"react\"),\n      REACT_ELEMENT_TYPE = Symbol.for(\"react.transitional.element\"),\n      REACT_PORTAL_TYPE = Symbol.for(\"react.portal\"),\n      REACT_FRAGMENT_TYPE = Symbol.for(\"react.fragment\"),\n      REACT_STRICT_MODE_TYPE = Symbol.for(\"react.strict_mode\"),\n      REACT_PROFILER_TYPE = Symbol.for(\"react.profiler\"),\n      REACT_CONSUMER_TYPE = Symbol.for(\"react.consumer\"),\n      REACT_CONTEXT_TYPE = Symbol.for(\"react.context\"),\n      REACT_FORWARD_REF_TYPE = Symbol.for(\"react.forward_ref\"),\n      REACT_SUSPENSE_TYPE = Symbol.for(\"react.suspense\"),\n      REACT_SUSPENSE_LIST_TYPE = Symbol.for(\"react.suspense_list\"),\n      REACT_MEMO_TYPE = Symbol.for(\"react.memo\"),\n      REACT_LAZY_TYPE = Symbol.for(\"react.lazy\"),\n      REACT_ACTIVITY_TYPE = Symbol.for(\"react.activity\"),\n      REACT_CLIENT_REFERENCE = Symbol.for(\"react.client.reference\"),\n      ReactSharedInternals =\n        React.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,\n      hasOwnProperty = Object.prototype.hasOwnProperty,\n      isArrayImpl = Array.isArray,\n      createTask = console.createTask\n        ? console.createTask\n        : function () {\n            return null;\n          };\n    React = {\n      react_stack_bottom_frame: function (callStackForError) {\n        return callStackForError();\n      }\n    };\n    var specialPropKeyWarningShown;\n    var didWarnAboutElementRef = {};\n    var unknownOwnerDebugStack = React.react_stack_bottom_frame.bind(\n      React,\n      UnknownOwner\n    )();\n    var unknownOwnerDebugTask = createTask(getTaskName(UnknownOwner));\n    var didWarnAboutKeySpread = {};\n    exports.Fragment = REACT_FRAGMENT_TYPE;\n    exports.jsx = function (type, config, maybeKey) {\n      var trackActualOwner =\n        1e4 > ReactSharedInternals.recentlyCreatedOwnerStacks++;\n      return jsxDEVImpl(\n        type,\n        config,\n        maybeKey,\n        !1,\n        trackActualOwner\n          ? Error(\"react-stack-top-frame\")\n          : unknownOwnerDebugStack,\n        trackActualOwner ? createTask(getTaskName(type)) : unknownOwnerDebugTask\n      );\n    };\n    exports.jsxs = function (type, config, maybeKey) {\n      var trackActualOwner =\n        1e4 > ReactSharedInternals.recentlyCreatedOwnerStacks++;\n      return jsxDEVImpl(\n        type,\n        config,\n        maybeKey,\n        !0,\n        trackActualOwner\n          ? Error(\"react-stack-top-frame\")\n          : unknownOwnerDebugStack,\n        trackActualOwner ? createTask(getTaskName(type)) : unknownOwnerDebugTask\n      );\n    };\n  })();\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","// Re-export from vanilla package\nimport { generateId as vanillaGenerateId, except, only, rejectNullValues, kebabCase, isStandardDomEvent } from '@inertiaui/vanilla'\nexport { except, only, rejectNullValues, kebabCase, isStandardDomEvent }\n\n// Modal-specific helpers\n\nlet generateIdUsingCallback: (() => string) | null = null\n\nfunction generateIdUsing(callback: () => string): void {\n    generateIdUsingCallback = callback\n}\n\nfunction generateId(prefix: string = 'inertiaui_modal_'): string {\n    if (generateIdUsingCallback) {\n        return generateIdUsingCallback()\n    }\n    return vanillaGenerateId(prefix)\n}\n\nfunction sameUrlPath(url1: string | URL, url2: string | URL): boolean {\n    const origin = typeof window !== 'undefined' ? window.location.origin : 'http://localhost'\n    const parsed1 = typeof url1 === 'string' ? new URL(url1, origin) : url1\n    const parsed2 = typeof url2 === 'string' ? new URL(url2, origin) : url2\n\n    return `${parsed1.origin}${parsed1.pathname}` === `${parsed2.origin}${parsed2.pathname}`\n}\n\nexport { generateIdUsing, generateId, sameUrlPath }\n","import { createElement, useEffect, useState, useRef, useReducer, ReactNode, ComponentType } from 'react'\nimport { default as Axios, AxiosResponse, InternalAxiosRequestConfig } from 'axios'\nimport { except, kebabCase, generateId, sameUrlPath } from './helpers'\nimport { router, usePage, progress } from '@inertiajs/react'\nimport { mergeDataIntoQueryString, type RequestPayload } from '@inertiajs/core'\nimport { createContext, useContext } from 'react'\nimport ModalRenderer from './ModalRenderer'\nimport { getConfig } from './config'\nimport type {\n    Modal,\n    ModalConfig,\n    ModalResponseData,\n    ModalStackContextValue,\n    VisitOptions,\n    ReloadOptions,\n    EventCallback,\n    ComponentResolver,\n    PageProps,\n    ModalRootProps,\n    LocalModal,\n    PrefetchOptions,\n} from './types'\n\nconst ModalStackContext = createContext<ModalStackContextValue | null>(null)\nModalStackContext.displayName = 'ModalStackContext'\n\nlet pageVersion: string | null = null\nlet resolveComponent: ComponentResolver | null = null\nlet baseUrl: string | null = null\n\n// Prefetch cache (#146)\ninterface PrefetchCacheEntry {\n    response: AxiosResponse\n    timestamp: number\n    expiresAt: number\n}\n\nconst prefetchCache = new Map<string, PrefetchCacheEntry>()\nconst prefetchInFlight = new Map<string, Promise<AxiosResponse>>()\n\nfunction getPrefetchCacheKey(url: string, method: string, data: RequestPayload): string {\n    return `${method}:${url}:${JSON.stringify(data)}`\n}\n\nfunction getCachedResponse(url: string, method: string, data: RequestPayload): AxiosResponse | null {\n    const key = getPrefetchCacheKey(url, method, data)\n    const cached = prefetchCache.get(key)\n\n    if (!cached) {\n        return null\n    }\n\n    if (Date.now() > cached.expiresAt) {\n        prefetchCache.delete(key)\n        return null\n    }\n\n    return cached.response\n}\n\nfunction setCachedResponse(url: string, method: string, data: RequestPayload, response: AxiosResponse, cacheFor: number): void {\n    const key = getPrefetchCacheKey(url, method, data)\n    prefetchCache.set(key, {\n        response,\n        timestamp: Date.now(),\n        expiresAt: Date.now() + cacheFor,\n    })\n}\n\nexport function prefetch(href: string, options: PrefetchOptions = {}): Promise<void> {\n    if (href.startsWith('#')) {\n        return Promise.resolve()\n    }\n\n    const method = (options.method ?? 'get').toLowerCase()\n    const data = options.data ?? ({} as RequestPayload)\n    const headers = options.headers ?? {}\n    const queryStringArrayFormat = options.queryStringArrayFormat ?? 'brackets'\n    const cacheFor = options.cacheFor ?? 30000\n\n    const [url, mergedData] = mergeDataIntoQueryString(method as 'get' | 'post' | 'put' | 'patch' | 'delete', href || '', data, queryStringArrayFormat)\n\n    // Check if already cached\n    const cached = getCachedResponse(url, method, mergedData)\n    if (cached) {\n        return Promise.resolve()\n    }\n\n    // Check if already in flight\n    const cacheKey = getPrefetchCacheKey(url, method, mergedData)\n    const inFlight = prefetchInFlight.get(cacheKey)\n    if (inFlight) {\n        return inFlight.then(() => {})\n    }\n\n    options.onPrefetching?.()\n\n    const requestHeaders: Record<string, string> = {\n        ...headers,\n        Accept: 'text/html, application/xhtml+xml',\n        'X-Requested-With': 'XMLHttpRequest',\n        'X-Inertia': 'true',\n        'X-Inertia-Version': pageVersion ?? '',\n        'X-InertiaUI-Modal': generateId(),\n        'X-InertiaUI-Modal-Base-Url': baseUrl ?? '',\n    }\n\n    const request = Axios({\n        url,\n        method,\n        data: mergedData,\n        headers: requestHeaders,\n    })\n        .then((response) => {\n            setCachedResponse(url, method, mergedData, response, cacheFor)\n            options.onPrefetched?.()\n            return response\n        })\n        .finally(() => {\n            prefetchInFlight.delete(cacheKey)\n        })\n\n    prefetchInFlight.set(cacheKey, request)\n\n    return request.then(() => {})\n}\n\ninterface ModalStackProviderProps {\n    children: ReactNode\n}\n\nexport const ModalStackProvider = ({ children }: ModalStackProviderProps) => {\n    // Use ref for synchronous access to stack, state only for triggering re-renders\n    const stackRef = useRef<Modal[]>([])\n    const [, forceUpdate] = useReducer((x) => x + 1, 0)\n    const [localModals, setLocalModals] = useState<Record<string, LocalModal>>({})\n\n    const updateStack = (withStack: (prevStack: Modal[]) => Modal[]) => {\n        const newStack = withStack([...stackRef.current])\n\n        const isOnTopOfStack = (modalId: string) => {\n            if (newStack.length < 2) {\n                return true\n            }\n\n            return (\n                newStack\n                    .map((modal) => ({ id: modal.id, shouldRender: modal.shouldRender }))\n                    .reverse()\n                    .find((modal) => modal.shouldRender)?.id === modalId\n            )\n        }\n\n        newStack.forEach((modal, index) => {\n            newStack[index].onTopOfStack = isOnTopOfStack(modal.id)\n            newStack[index].getParentModal = () => {\n                if (index < 1) {\n                    // This is the first modal in the stack\n                    return null\n                }\n\n                // Find the first open modal before this one\n                return (\n                    stackRef.current\n                        .slice(0, index)\n                        .reverse()\n                        .find((m) => m.isOpen) ?? null\n                )\n            }\n            newStack[index].getChildModal = () => {\n                if (index === stackRef.current.length - 1) {\n                    // This is the last modal in the stack\n                    return null\n                }\n\n                // Find the first open modal after this one\n                return stackRef.current.slice(index + 1).find((m) => m.isOpen) ?? null\n            }\n        })\n\n        stackRef.current = newStack\n        forceUpdate()\n    }\n\n    class ModalClass implements Modal {\n        id: string\n        isOpen: boolean\n        shouldRender: boolean\n        listeners: Record<string, EventCallback[]>\n        component: ComponentType | null\n        props: Record<string, unknown>\n        response: ModalResponseData\n        config: ModalConfig\n        onCloseCallback: (() => void) | null\n        afterLeaveCallback: (() => void) | null\n        index: number\n        onTopOfStack: boolean\n        name?: string\n        getParentModal: () => Modal | null\n        getChildModal: () => Modal | null\n\n        constructor(\n            component: ComponentType | null,\n            response: ModalResponseData,\n            config?: ModalConfig | null,\n            onClose?: (() => void) | null,\n            afterLeave?: (() => void) | null,\n        ) {\n            this.id = response.id ?? generateId()\n            this.isOpen = false\n            this.shouldRender = false\n            this.listeners = {}\n\n            this.component = component\n            this.props = response.props ?? {}\n            this.response = response\n            this.config = config ?? {}\n            this.onCloseCallback = onClose ?? null\n            this.afterLeaveCallback = afterLeave ?? null\n\n            this.index = -1 // Will be set when added to the stack\n            this.getParentModal = () => null // Will be set in push()\n            this.getChildModal = () => null // Will be set in push()\n            this.onTopOfStack = true // Will be updated in push()\n        }\n\n        show = () => {\n            updateStack((prevStack) =>\n                prevStack.map((modal) => {\n                    if (modal.id === this.id && !modal.isOpen) {\n                        modal.isOpen = true\n                        modal.shouldRender = true\n                    }\n                    return modal\n                }),\n            )\n        }\n\n        setOpen = (open: boolean) => {\n            if (open) {\n                this.show()\n            } else {\n                this.close()\n            }\n        }\n\n        close = () => {\n            updateStack((currentStack) => {\n                let modalClosed = false\n\n                const newStack = currentStack.map((modal) => {\n                    if (modal.id === this.id && modal.isOpen) {\n                        Object.keys(modal.listeners).forEach((event) => {\n                            modal.off(event)\n                        })\n\n                        modal.isOpen = false\n                        modal.onCloseCallback?.()\n                        modalClosed = true\n                    }\n                    return modal\n                })\n\n                return modalClosed ? newStack : currentStack\n            })\n        }\n\n        afterLeave = () => {\n            if (this.isOpen) {\n                return\n            }\n\n            updateStack((prevStack) => {\n                const updatedStack = prevStack.map((modal) => {\n                    if (modal.id === this.id && !modal.isOpen) {\n                        modal.shouldRender = false\n                        modal.afterLeaveCallback?.()\n                        modal.afterLeaveCallback = null\n                    }\n                    return modal\n                })\n\n                if (this.index === 0) {\n                    // Update browser URL back to base when all modals are closed\n                    if (baseUrl && typeof window !== 'undefined') {\n                        router.push({\n                            url: baseUrl,\n                            preserveScroll: true,\n                            preserveState: true,\n                            // Clear _inertiaui_modal prop to prevent modal from reopening\n                            props: (currentProps: Record<string, unknown>) => {\n                                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                                const { _inertiaui_modal, ...rest } = currentProps\n                                return { ...rest, _inertiaui_modal: undefined }\n                            },\n                        })\n                    }\n                    baseUrl = null\n                    return []\n                }\n\n                return updatedStack\n            })\n        }\n\n        on = (event: string, callback: EventCallback) => {\n            event = kebabCase(event)\n            this.listeners[event] = this.listeners[event] ?? []\n            this.listeners[event].push(callback)\n        }\n\n        off = (event: string, callback?: EventCallback) => {\n            event = kebabCase(event)\n            if (callback) {\n                this.listeners[event] = this.listeners[event]?.filter((cb) => cb !== callback) ?? []\n            } else {\n                delete this.listeners[event]\n            }\n        }\n\n        emit = (event: string, ...args: unknown[]) => {\n            this.listeners[kebabCase(event)]?.forEach((callback) => callback(...args))\n        }\n\n        registerEventListenersFromProps = (props: Record<string, unknown>) => {\n            const unsubscribers: (() => void)[] = []\n\n            Object.keys(props)\n                .filter((key) => key.startsWith('on'))\n                .forEach((key) => {\n                    // e.g. onRefreshKey -> refresh-key\n                    const eventName = kebabCase(key).replace(/^on-/, '')\n                    const callback = props[key] as EventCallback\n                    this.on(eventName, callback)\n                    unsubscribers.push(() => this.off(eventName, callback))\n                })\n\n            return () => unsubscribers.forEach((unsub) => unsub())\n        }\n\n        reload = (options: ReloadOptions = {}) => {\n            let keys = Object.keys(this.response.props)\n\n            if (options.only) {\n                keys = options.only\n            }\n\n            if (options.except) {\n                keys = except(keys, options.except) as string[]\n            }\n\n            if (!this.response?.url) {\n                return\n            }\n\n            const method = (options.method ?? 'get').toLowerCase()\n            const data = options.data ?? {}\n\n            options.onStart?.()\n\n            Axios({\n                url: this.response.url,\n                method,\n                data: method === 'get' ? {} : data,\n                params: method === 'get' ? data : {},\n                headers: {\n                    ...(options.headers ?? {}),\n                    Accept: 'text/html, application/xhtml+xml',\n                    'X-Inertia': 'true',\n                    'X-Inertia-Partial-Component': this.response.component,\n                    'X-Inertia-Version': this.response.version ?? '',\n                    'X-Inertia-Partial-Data': keys.join(','),\n                    'X-InertiaUI-Modal': generateId(),\n                    'X-InertiaUI-Modal-Base-Url': baseUrl ?? '',\n                },\n            })\n                .then((response) => {\n                    this.updateProps(response.data.props)\n\n                    options.onSuccess?.(response)\n                })\n                .catch((error) => {\n                    options.onError?.(error)\n                })\n                .finally(() => {\n                    options.onFinish?.()\n                })\n        }\n\n        updateProps = (props: Record<string, unknown>) => {\n            Object.assign(this.props, props)\n            updateStack((prevStack) => prevStack) // Trigger re-render\n        }\n    }\n\n    const isValidModalResponse = (data: unknown): data is ModalResponseData => {\n        return (\n            typeof data === 'object' &&\n            data !== null &&\n            'component' in data &&\n            typeof (data as ModalResponseData).component === 'string'\n        )\n    }\n\n    const pushFromResponseData = (\n        responseData: ModalResponseData,\n        config: ModalConfig = {},\n        onClose: (() => void) | null = null,\n        onAfterLeave: (() => void) | null = null,\n    ): Promise<Modal> => {\n        if (!resolveComponent) {\n            return Promise.reject(new Error('resolveComponent not set'))\n        }\n\n        if (!isValidModalResponse(responseData)) {\n            return Promise.reject(\n                new Error(\n                    'Invalid modal response. This usually happens when the server returns a redirect (e.g., due to session expiration). ' +\n                        'Check if the user is still authenticated.',\n                ),\n            )\n        }\n\n        return resolveComponent(responseData.component).then((component) =>\n            push(component, responseData, config, onClose, onAfterLeave),\n        )\n    }\n\n    const loadDeferredProps = (modal: Modal) => {\n        const deferred = modal.response?.meta?.deferredProps\n\n        if (!deferred) {\n            return\n        }\n\n        Object.keys(deferred).forEach((key) => {\n            modal.reload({ only: deferred[key] })\n        })\n    }\n\n    const push = (\n        component: ComponentType | null,\n        response: ModalResponseData,\n        config?: ModalConfig | null,\n        onClose?: (() => void) | null,\n        afterLeave?: (() => void) | null,\n    ): Modal => {\n        const newModal = new ModalClass(component, response, config, onClose, afterLeave)\n        newModal.index = stackRef.current.length\n\n        updateStack((prevStack) => [...prevStack, newModal])\n        loadDeferredProps(newModal)\n\n        newModal.show()\n\n        return newModal\n    }\n\n    function pushLocalModal(\n        name: string,\n        config?: ModalConfig | null,\n        onClose?: (() => void) | null,\n        afterLeave?: (() => void) | null,\n        props?: Record<string, unknown> | null,\n    ): Modal {\n        if (!localModals[name]) {\n            throw new Error(`The local modal \"${name}\" has not been registered.`)\n        }\n\n        const responseData = { props: props ?? {} } as ModalResponseData\n        const modal = push(null, responseData, config, onClose, afterLeave)\n        modal.name = name\n        localModals[name].callback(modal)\n        return modal\n    }\n\n    const visitModal = (url: string, options: VisitOptions = {}): Promise<Modal> =>\n        visit(\n            url,\n            options.method ?? 'get',\n            options.data ?? ({} as RequestPayload),\n            options.headers ?? {},\n            options.config ?? {},\n            options.onClose ?? null,\n            options.onAfterLeave ?? null,\n            options.queryStringArrayFormat ?? 'brackets',\n            options.navigate ?? (getConfig('navigate') as boolean),\n            options.onStart ?? null,\n            options.onSuccess ?? null,\n            options.onError ?? null,\n            options.props ?? null,\n        ).then((modal) => {\n            const listeners = options.listeners ?? {}\n\n            Object.keys(listeners).forEach((event) => {\n                // e.g. refreshKey -> refresh-key\n                const eventName = kebabCase(event)\n                modal.on(eventName, listeners[event])\n            })\n\n            return modal\n        })\n\n    const updateBrowserUrl = (url: string | undefined, useBrowserHistory: boolean, modalData?: ModalResponseData): void => {\n        if (!url || !useBrowserHistory || typeof window === 'undefined') {\n            return\n        }\n\n        router.push({\n            url,\n            preserveScroll: true,\n            preserveState: true,\n            // Store modal data in page props for history navigation\n            props: modalData\n                ? (currentProps: Record<string, unknown>) => ({\n                      ...currentProps,\n                      _inertiaui_modal: {\n                          ...modalData,\n                          baseUrl,\n                      },\n                  })\n                : undefined,\n        })\n    }\n\n    const visit = (\n        href: string,\n        method: string,\n        payload: RequestPayload = {},\n        headers: Record<string, string> = {},\n        config: ModalConfig = {},\n        onClose: (() => void) | null = null,\n        onAfterLeave: (() => void) | null = null,\n        queryStringArrayFormat: 'brackets' | 'indices' = 'brackets',\n        useBrowserHistory = false,\n        onStart: (() => void) | null = null,\n        onSuccess: ((response?: AxiosResponse) => void) | null = null,\n        onError: ((...args: unknown[]) => void) | null = null,\n        props: Record<string, unknown> | null = null,\n    ): Promise<Modal> => {\n        const modalId = generateId()\n\n        return new Promise((resolve, reject) => {\n            if (href.startsWith('#')) {\n                resolve(pushLocalModal(href.substring(1), config, onClose, onAfterLeave, props))\n                return\n            }\n\n            const [url, data] = mergeDataIntoQueryString(method as 'get' | 'post' | 'put' | 'patch' | 'delete', href || '', payload, queryStringArrayFormat)\n\n            // Check for cached prefetch response (#146)\n            const cachedResponse = getCachedResponse(url, method, data)\n            if (cachedResponse) {\n                onSuccess?.(cachedResponse)\n                pushFromResponseData(cachedResponse.data, config, onClose, onAfterLeave)\n                    .then((modal) => {\n                        updateBrowserUrl(cachedResponse.data.url, useBrowserHistory, cachedResponse.data)\n                        resolve(modal)\n                    })\n                    .catch(reject)\n                return\n            }\n\n            if (stackRef.current.length === 0) {\n                baseUrl = typeof window !== 'undefined' ? window.location.href : ''\n            }\n\n            const requestHeaders: Record<string, string> = {\n                ...headers,\n                Accept: 'text/html, application/xhtml+xml',\n                'X-Requested-With': 'XMLHttpRequest',\n                'X-Inertia': 'true',\n                'X-Inertia-Version': pageVersion ?? '',\n                'X-InertiaUI-Modal': modalId,\n                'X-InertiaUI-Modal-Base-Url': baseUrl ?? '',\n            }\n\n            onStart?.()\n\n            progress?.start()\n\n            Axios({\n                url,\n                method,\n                data,\n                headers: requestHeaders,\n            })\n                .then((response) => {\n                    onSuccess?.(response)\n                    pushFromResponseData(response.data, config, onClose, onAfterLeave)\n                        .then((modal) => {\n                            updateBrowserUrl(response.data.url, useBrowserHistory, response.data)\n                            resolve(modal)\n                        })\n                        .catch(reject)\n                })\n                .catch((...args: unknown[]) => {\n                    onError?.(...args)\n                    reject(args[0])\n                })\n                .finally(() => {\n                    progress?.finish()\n                })\n        })\n    }\n\n    const registerLocalModal = (name: string, callback: (modal: Modal) => void) => {\n        setLocalModals((prevLocalModals) => ({\n            ...prevLocalModals,\n            [name]: { name, callback },\n        }))\n    }\n\n    const removeLocalModal = (name: string) => {\n        setLocalModals((prevLocalModals) => {\n            const newLocalModals = { ...prevLocalModals }\n            delete newLocalModals[name]\n            return newLocalModals\n        })\n    }\n\n    // Create value object with getter for stack to ensure we always get current ref value\n    const value: ModalStackContextValue = {\n        get stack() {\n            return stackRef.current\n        },\n        localModals,\n        push,\n        pushFromResponseData,\n        length: () => stackRef.current.length,\n        closeAll: (force = false) => {\n            if (force) {\n                // Force close: immediately remove all modals without transition\n                updateStack(() => [])\n            } else {\n                // Normal close: trigger leave transition for each modal\n                ;[...stackRef.current].reverse().forEach((modal) => modal.close())\n            }\n        },\n        reset: () => updateStack(() => []),\n        visit,\n        visitModal,\n        registerLocalModal,\n        removeLocalModal,\n    }\n\n    return <ModalStackContext.Provider value={value}>{children}</ModalStackContext.Provider>\n}\n\nexport const useModalStack = (): ModalStackContextValue => {\n    const context = useContext(ModalStackContext)\n    if (context === null) {\n        throw new Error('useModalStack must be used within a ModalStackProvider')\n    }\n    return context\n}\n\nexport const modalPropNames = ['closeButton', 'closeExplicitly', 'closeOnClickOutside', 'maxWidth', 'paddingClasses', 'panelClasses', 'position', 'slideover']\n\nexport const initFromPageProps = (pageProps: PageProps) => {\n    if (pageProps.initialPage) {\n        pageVersion = pageProps.initialPage.version ?? null\n    }\n\n    if (pageProps.resolveComponent) {\n        resolveComponent = pageProps.resolveComponent\n    }\n}\n\ninterface RenderInertiaAppProps {\n    Component: ComponentType & { layout?: ((page: ReactNode) => ReactNode) | ComponentType[] }\n    props: Record<string, unknown>\n    key: string\n}\n\nexport const renderApp = (App: ComponentType<{ children: (props: RenderInertiaAppProps) => ReactNode }>, pageProps: PageProps) => {\n    initFromPageProps(pageProps)\n\n    const renderInertiaApp = ({ Component, props, key }: RenderInertiaAppProps) => {\n        const renderComponent = () => {\n            const child = createElement(Component, { key, ...props })\n\n            if (typeof Component.layout === 'function') {\n                return Component.layout(child)\n            }\n\n            if (Array.isArray(Component.layout)) {\n                return Component.layout\n                    .slice()\n                    .reverse()\n                    .reduce(\n                        (acc, Layout) => createElement(Layout as ComponentType<Record<string, unknown>>, props, acc),\n                        child as ReactNode,\n                    )\n            }\n\n            return child\n        }\n\n        return (\n            <>\n                {renderComponent()}\n                <ModalRoot />\n            </>\n        )\n    }\n\n    return (\n        <ModalStackProvider>\n            <App {...(pageProps as Record<string, unknown>)}>{renderInertiaApp}</App>\n        </ModalStackProvider>\n    )\n}\n\ninterface InertiaUIModalPageProps {\n    _inertiaui_modal?: ModalResponseData & { baseUrl: string }\n    [key: string]: unknown\n}\n\nexport const ModalRoot = ({ children }: ModalRootProps) => {\n    const context = useContext(ModalStackContext)\n    const $page = usePage<InertiaUIModalPageProps>()\n    const pendingModalKeysRef = useRef(new Set<string>())\n\n    // Generate a unique key for deduplication (handles case when modal has no id)\n    const getModalKey = (modalData: ModalResponseData) => modalData.id || `${modalData.component}:${modalData.url}`\n\n    const isNavigatingRef = useRef(false)\n    const initialModalStillOpenedRef = useRef(!!$page.props?._inertiaui_modal)\n\n    useEffect(() => router.on('start', () => (isNavigatingRef.current = true)), [])\n    useEffect(() => router.on('finish', () => (isNavigatingRef.current = false)), [])\n    useEffect(\n        () =>\n            router.on('navigate', function ($event) {\n                const modalOnBase = ($event as { detail: { page: { props: InertiaUIModalPageProps; url: string } } }).detail.page.props._inertiaui_modal\n                const pageUrl = ($event as { detail: { page: { url: string } } }).detail.page.url\n\n                if (!modalOnBase) {\n                    // No modal data - close any open modals (force close without transition)\n                    context?.closeAll(true)\n                    baseUrl = null\n                    initialModalStillOpenedRef.current = false\n                    return\n                }\n\n                // If the page URL doesn't match the modal URL, close all modals\n                if (!sameUrlPath(pageUrl, modalOnBase.url)) {\n                    context?.closeAll(true)\n                    baseUrl = null\n                    initialModalStillOpenedRef.current = false\n                    return\n                }\n\n                baseUrl = modalOnBase.baseUrl\n\n                // Skip if this modal is already being pushed (handles duplicate navigate events)\n                const modalKey = getModalKey(modalOnBase)\n                if (pendingModalKeysRef.current.has(modalKey)) {\n                    return\n                }\n\n                // Also skip if a modal with this id is already in the stack\n                if (modalOnBase.id && context?.stack.some((m) => m.id === modalOnBase.id)) {\n                    return\n                }\n\n                // Skip if a modal with the same component and URL is already open\n                if (context?.stack.some((m) => m.response?.component === modalOnBase.component && sameUrlPath(m.response?.url, modalOnBase.url))) {\n                    return\n                }\n\n                pendingModalKeysRef.current.add(modalKey)\n\n                context\n                    ?.pushFromResponseData(modalOnBase, {}, () => {\n                        if (!modalOnBase.baseUrl) {\n                            console.error('No base url in modal response data so cannot navigate back')\n                            return\n                        }\n                        if (!isNavigatingRef.current && typeof window !== 'undefined' && window.location.href !== modalOnBase.baseUrl) {\n                            router.visit(modalOnBase.baseUrl, {\n                                preserveScroll: true,\n                                preserveState: true,\n                            })\n                        }\n                    })\n                    .then(() => {\n                        pendingModalKeysRef.current.delete(modalKey)\n                    })\n            }),\n        [],\n    )\n\n    const axiosRequestInterceptor = (config: InternalAxiosRequestConfig) => {\n        // A Modal is opened on top of a base route, so we need to pass this base route\n        // so it can redirect back with the back() helper method...\n        // Only send the header when we have an actual base URL value\n        const baseUrlValue = baseUrl ?? (initialModalStillOpenedRef.current ? $page.props._inertiaui_modal?.baseUrl : null)\n        if (baseUrlValue) {\n            config.headers['X-InertiaUI-Modal-Base-Url'] = baseUrlValue\n        }\n\n        return config\n    }\n\n    useEffect(() => {\n        const interceptorId = Axios.interceptors.request.use(axiosRequestInterceptor)\n        return () => Axios.interceptors.request.eject(interceptorId)\n    }, [])\n\n    const previousModalRef = useRef<(ModalResponseData & { baseUrl: string }) | undefined>(undefined)\n\n    useEffect(() => {\n        const newModal = $page.props?._inertiaui_modal\n        const previousModal = previousModalRef.current\n\n        // Store the current value for the next render\n        previousModalRef.current = newModal\n\n        if (!newModal) {\n            return\n        }\n\n        // If there's a previous modal with same component/URL, update its props\n        if (previousModal && newModal.component === previousModal.component && sameUrlPath(newModal.url, previousModal.url)) {\n            context?.stack[0]?.updateProps(newModal.props ?? {})\n            return\n        }\n\n        // If there's no previous modal but we have modals in the stack (opened via XHR),\n        // check if the new modal matches any open modal and update its props\n        if (!previousModal && context && context.stack.length > 0) {\n            const existingModal = context.stack.find(\n                (m) => m.response?.component === newModal.component && sameUrlPath(m.response?.url, newModal.url),\n            )\n            if (existingModal) {\n                existingModal.updateProps(newModal.props ?? {})\n            }\n        }\n    }, [$page.props?._inertiaui_modal])\n\n    return (\n        <>\n            {children}\n            {context && context.stack.length > 0 && <ModalRenderer index={0} />}\n        </>\n    )\n}\n","import React, { useMemo, createElement } from 'react'\nimport { useModalStack } from './ModalRoot'\nimport type { ModalRendererProps } from './types'\n\nconst ModalIndexContext = React.createContext<number | null>(null)\nModalIndexContext.displayName = 'ModalIndexContext'\n\nexport const useModalIndex = (): number | null => {\n    return React.useContext(ModalIndexContext)\n}\n\nconst ModalRenderer = ({ index }: ModalRendererProps) => {\n    const { stack } = useModalStack()\n\n    const modalContext = useMemo(() => {\n        return stack[index]\n    }, [stack, index])\n\n    if (!modalContext?.component) {\n        return null\n    }\n\n    return (\n        <ModalIndexContext.Provider value={index}>\n            {createElement(modalContext.component as React.ComponentType<Record<string, unknown>>, {\n                ...modalContext.props,\n                onModalEvent: (...args: unknown[]) => modalContext.emit('modal-event', ...args),\n            })}\n        </ModalIndexContext.Provider>\n    )\n}\n\nexport default ModalRenderer\n","import { useModalIndex } from './ModalRenderer'\nimport { useModalStack } from './ModalRoot'\nimport type { Modal } from './types'\n\nexport default function useModal(): Modal | null {\n    return useModalStack().stack[useModalIndex()] ?? null\n}\n","// See: https://github.com/inertiajs/inertia/blob/48bcd21fb7daf467d0df1bfde2408f161f94a579/packages/react/src/Deferred.ts\nimport { useEffect, useState, ReactNode } from 'react'\nimport useModal from './useModal'\n\ninterface DeferredProps {\n    children: ReactNode\n    data: string | string[]\n    fallback?: ReactNode\n}\n\nconst Deferred = ({ children, data, fallback }: DeferredProps) => {\n    if (!data) {\n        throw new Error('`<Deferred>` requires a `data` prop to be a string or array of strings')\n    }\n\n    const [loaded, setLoaded] = useState(false)\n    const keys = Array.isArray(data) ? data : [data]\n    const modal = useModal()\n    const modalProps = modal?.props ?? {}\n\n    useEffect(() => {\n        setLoaded(keys.every((key) => modalProps[key] !== undefined))\n    }, [modalProps, keys])\n\n    return loaded ? children : fallback\n}\n\nDeferred.displayName = 'InertiaModalDeferred'\n\nexport default Deferred\n","import { useMemo, useState, forwardRef, useImperativeHandle, useEffect, useRef, ReactNode } from 'react'\nimport { getConfig, getConfigByType } from './config'\nimport { useModalIndex } from './ModalRenderer'\nimport { useModalStack } from './ModalRoot'\nimport ModalRenderer from './ModalRenderer'\nimport type { Modal, ModalConfig, ReloadOptions } from './types'\n\ninterface HeadlessModalConfig {\n    slideover: boolean\n    closeButton: boolean\n    closeExplicitly: boolean\n    closeOnClickOutside: boolean\n    maxWidth: string\n    paddingClasses: string\n    panelClasses: string\n    position: string\n}\n\ninterface HeadlessModalRenderProps {\n    afterLeave: () => void\n    close: () => void\n    config: HeadlessModalConfig\n    emit: (event: string, ...args: unknown[]) => void\n    getChildModal: () => Modal | null\n    getParentModal: () => Modal | null\n    id: string\n    index: number\n    isOpen: boolean\n    modalContext: Modal\n    onTopOfStack: boolean\n    reload: (options?: ReloadOptions) => void\n    setOpen: (open: boolean) => void\n    shouldRender: boolean\n    // Allow additional props from visitModal\n    [key: string]: unknown\n}\n\ninterface HeadlessModalBaseProps {\n    name?: string\n    children: ReactNode | ((props: HeadlessModalRenderProps) => ReactNode)\n    onFocus?: () => void\n    onBlur?: () => void\n    onClose?: () => void\n    onSuccess?: () => void\n    slideover?: boolean\n    closeButton?: boolean\n    closeExplicitly?: boolean\n    closeOnClickOutside?: boolean\n    maxWidth?: string\n    paddingClasses?: string\n    panelClasses?: string\n    position?: string\n}\n\ntype HeadlessModalProps = HeadlessModalBaseProps & Record<string, unknown>\n\nexport interface HeadlessModalRef {\n    afterLeave: () => void\n    close: () => void\n    emit: (event: string, ...args: unknown[]) => void\n    getChildModal: () => Modal | null | undefined\n    getParentModal: () => Modal | null | undefined\n    reload: (options?: ReloadOptions) => void\n    setOpen: (open: boolean) => void\n    readonly id: string | undefined\n    readonly index: number | undefined\n    readonly isOpen: boolean | undefined\n    readonly config: ModalConfig | undefined\n    readonly modalContext: Modal | null\n    readonly onTopOfStack: boolean | undefined\n    readonly shouldRender: boolean | undefined\n}\n\nconst HeadlessModal = forwardRef<HeadlessModalRef, HeadlessModalProps>(\n    (allProps, ref) => {\n        const { name, children, onFocus, onBlur, onClose, onSuccess, ...props } = allProps as HeadlessModalBaseProps & Record<string, unknown>\n        const modalIndex = useModalIndex()\n        const { stack, registerLocalModal, removeLocalModal } = useModalStack()\n\n        const [localModalContext, setLocalModalContext] = useState<Modal | null>(null)\n        const modalContext = useMemo(\n            () => (name ? localModalContext : stack[modalIndex]),\n            [name, localModalContext, modalIndex, stack],\n        )\n\n        const nextIndex = useMemo(() => {\n            return stack.find((m) => m.shouldRender && m.index > (modalContext?.index ?? -1))?.index\n        }, [modalIndex, stack])\n\n        const configSlideover = useMemo(\n            () => modalContext?.config.slideover ?? props.slideover ?? getConfig('type') === 'slideover',\n            [props.slideover, modalContext?.config.slideover],\n        )\n\n        const config: HeadlessModalConfig = useMemo(\n            () => ({\n                slideover: configSlideover as boolean,\n                closeButton: (props.closeButton ?? getConfigByType(configSlideover as boolean, 'closeButton')) as boolean,\n                closeExplicitly: (props.closeExplicitly ?? getConfigByType(configSlideover as boolean, 'closeExplicitly')) as boolean,\n                closeOnClickOutside: (props.closeOnClickOutside ?? getConfigByType(configSlideover as boolean, 'closeOnClickOutside')) as boolean,\n                maxWidth: (props.maxWidth ?? getConfigByType(configSlideover as boolean, 'maxWidth')) as string,\n                paddingClasses: (props.paddingClasses ?? getConfigByType(configSlideover as boolean, 'paddingClasses')) as string,\n                panelClasses: (props.panelClasses ?? getConfigByType(configSlideover as boolean, 'panelClasses')) as string,\n                position: (props.position ?? getConfigByType(configSlideover as boolean, 'position')) as string,\n                ...modalContext?.config,\n            }),\n            [props, modalContext?.config, configSlideover],\n        )\n\n        useEffect(() => {\n            if (name) {\n                let removeListeners: (() => void) | null = null\n\n                registerLocalModal(name as string, (localContext) => {\n                    removeListeners = localContext.registerEventListenersFromProps(props as Record<string, unknown>)\n                    setLocalModalContext(localContext)\n                })\n\n                return () => {\n                    removeListeners?.()\n                    removeListeners = null\n                    removeLocalModal(name as string)\n                }\n            }\n\n            return modalContext?.registerEventListenersFromProps(props as Record<string, unknown>)\n        }, [name])\n\n        // Store the latest modalContext in a ref to maintain reference\n        const modalContextRef = useRef(modalContext)\n\n        // Update the ref whenever modalContext changes\n        useEffect(() => {\n            modalContextRef.current = modalContext\n        }, [modalContext])\n\n        // Track previous isOpen value to only emit close when transitioning from true to false\n        const previousIsOpenRef = useRef<boolean | undefined>(undefined)\n\n        useEffect(() => {\n            if (modalContext !== null) {\n                if (modalContext.isOpen) {\n                    onSuccess?.()\n                } else if (previousIsOpenRef.current === true) {\n                    // Only call onClose when transitioning from open to closed,\n                    // not when the component first mounts with isOpen undefined/false\n                    onClose?.()\n                }\n                previousIsOpenRef.current = modalContext.isOpen\n            }\n        }, [modalContext?.isOpen])\n\n        const [rendered, setRendered] = useState(false)\n\n        useEffect(() => {\n            if (rendered && modalContext !== null && modalContext.isOpen) {\n                if (modalContext.onTopOfStack) {\n                    onFocus?.()\n                } else {\n                    onBlur?.()\n                }\n            }\n\n            setRendered(true)\n        }, [modalContext?.onTopOfStack])\n\n        useImperativeHandle(\n            ref,\n            () => ({\n                afterLeave: () => modalContextRef.current?.afterLeave(),\n                close: () => modalContextRef.current?.close(),\n                emit: (...args: [string, ...unknown[]]) => modalContextRef.current?.emit(...args),\n                getChildModal: () => modalContextRef.current?.getChildModal(),\n                getParentModal: () => modalContextRef.current?.getParentModal(),\n                reload: (options?: ReloadOptions) => modalContextRef.current?.reload(options),\n                setOpen: (open: boolean) => modalContextRef.current?.setOpen(open),\n\n                get id() {\n                    return modalContextRef.current?.id\n                },\n                get index() {\n                    return modalContextRef.current?.index\n                },\n                get isOpen() {\n                    return modalContextRef.current?.isOpen\n                },\n                get config() {\n                    return modalContextRef.current?.config\n                },\n                get modalContext() {\n                    return modalContextRef.current\n                },\n                get onTopOfStack() {\n                    return modalContextRef.current?.onTopOfStack\n                },\n                get shouldRender() {\n                    return modalContextRef.current?.shouldRender\n                },\n            }),\n            [modalContext],\n        )\n\n        if (!modalContext?.shouldRender) {\n            return null\n        }\n\n        return (\n            <>\n                {typeof children === 'function'\n                    ? children({\n                          // Spread props first so they can be overridden by built-in props\n                          ...modalContext.props,\n                          afterLeave: modalContext.afterLeave,\n                          close: modalContext.close,\n                          config,\n                          emit: modalContext.emit,\n                          getChildModal: modalContext.getChildModal,\n                          getParentModal: modalContext.getParentModal,\n                          id: modalContext.id,\n                          index: modalContext.index,\n                          isOpen: modalContext.isOpen,\n                          modalContext,\n                          onTopOfStack: modalContext.onTopOfStack,\n                          reload: modalContext.reload,\n                          setOpen: modalContext.setOpen,\n                          shouldRender: modalContext.shouldRender,\n                      })\n                    : children}\n\n                {/* Next modal in the stack */}\n                {nextIndex !== undefined && <ModalRenderer index={nextIndex} />}\n            </>\n        )\n    },\n)\n\nHeadlessModal.displayName = 'HeadlessModal'\nexport default HeadlessModal\n","interface CloseButtonProps {\n    onClick: () => void\n}\n\nexport default function CloseButton({ onClick }: CloseButtonProps) {\n    return (\n        <button\n            type=\"button\"\n            className=\"im-close-button text-gray-400 hover:text-gray-500\"\n            onClick={onClick}\n        >\n            <span className=\"sr-only\">Close</span>\n            <svg\n                className=\"size-6\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n                fill=\"none\"\n                viewBox=\"0 0 24 24\"\n                strokeWidth=\"2\"\n                stroke=\"currentColor\"\n                aria-hidden=\"true\"\n            >\n                <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    d=\"M6 18L18 6M6 6l12 12\"\n                />\n            </svg>\n        </button>\n    )\n}\n","function r(e){var t,f,n=\"\";if(\"string\"==typeof e||\"number\"==typeof e)n+=e;else if(\"object\"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(f=r(e[t]))&&(n&&(n+=\" \"),n+=f)}else for(f in e)e[f]&&(n&&(n+=\" \"),n+=f);return n}export function clsx(){for(var e,t,f=0,n=\"\",o=arguments.length;f<o;f++)(e=arguments[f])&&(t=r(e))&&(n&&(n+=\" \"),n+=t);return n}export default clsx;","/**\n * Max width classes for modals and slideovers.\n * Uses a map lookup for Tailwind 4 compatibility (scanner picks up full class strings).\n */\nexport const maxWidthClasses: Record<string, string> = {\n    sm: 'sm:max-w-sm',\n    md: 'sm:max-w-md',\n    lg: 'sm:max-w-md md:max-w-lg',\n    xl: 'sm:max-w-md md:max-w-xl',\n    '2xl': 'sm:max-w-md md:max-w-xl lg:max-w-2xl',\n    '3xl': 'sm:max-w-md md:max-w-xl lg:max-w-3xl',\n    '4xl': 'sm:max-w-md md:max-w-xl lg:max-w-3xl xl:max-w-4xl',\n    '5xl': 'sm:max-w-md md:max-w-xl lg:max-w-3xl xl:max-w-5xl',\n    '6xl': 'sm:max-w-md md:max-w-xl lg:max-w-3xl xl:max-w-5xl 2xl:max-w-6xl',\n    '7xl': 'sm:max-w-md md:max-w-xl lg:max-w-3xl xl:max-w-5xl 2xl:max-w-7xl',\n}\n\nexport const defaultMaxWidth = '2xl'\n\nexport function getMaxWidthClass(maxWidth: string): string {\n    return maxWidthClasses[maxWidth] || maxWidthClasses[defaultMaxWidth]\n}\n","import { useState, useEffect, useRef, useCallback, useMemo, ReactNode, SyntheticEvent, MouseEvent } from 'react'\nimport CloseButton from './CloseButton'\nimport clsx from 'clsx'\nimport { createFocusTrap, onEscapeKey } from '../../vue/src/dialog'\nimport { getMaxWidthClass } from '../../vue/src/constants'\nimport type { Modal } from './types'\n\ninterface ModalContentConfig {\n    maxWidth: string\n    paddingClasses: string\n    panelClasses: string\n    position: string\n    closeButton: boolean\n    closeExplicitly?: boolean\n    closeOnClickOutside?: boolean\n}\n\ninterface ModalContentProps {\n    modalContext: Modal\n    config: ModalContentConfig\n    useNativeDialog: boolean\n    isFirstModal: boolean\n    onAfterLeave?: () => void\n    children: ReactNode | ((props: { modalContext: Modal; config: ModalContentConfig }) => ReactNode)\n}\n\nconst ModalContent = ({ modalContext, config, useNativeDialog, isFirstModal, onAfterLeave, children }: ModalContentProps) => {\n    const [entered, setEntered] = useState(false)\n    const [isLeaving, setIsLeaving] = useState(false)\n    const [transitionState, setTransitionState] = useState<'entering' | 'entered' | 'leaving' | 'exited'>('entering')\n    const wrapperRef = useRef<HTMLDivElement>(null)\n    const dialogRef = useRef<HTMLDialogElement>(null)\n    const cleanupFocusTrapRef = useRef<(() => void) | null>(null)\n    const cleanupEscapeKeyRef = useRef<(() => void) | null>(null)\n    const initialRender = useRef(true)\n\n    const maxWidthClass = useMemo(() => getMaxWidthClass(config.maxWidth), [config.maxWidth])\n\n    // ============ Non-native dialog handlers ============\n\n    const setupFocusTrap = useCallback(() => {\n        if (useNativeDialog) return\n        if (!wrapperRef.current || !modalContext.onTopOfStack) return\n        if (cleanupFocusTrapRef.current) return\n\n        cleanupFocusTrapRef.current = createFocusTrap(wrapperRef.current, {\n            initialFocus: true,\n            returnFocus: false,\n        })\n    }, [modalContext.onTopOfStack, useNativeDialog])\n\n    const cleanupFocusTrap = useCallback(() => {\n        if (cleanupFocusTrapRef.current) {\n            cleanupFocusTrapRef.current()\n            cleanupFocusTrapRef.current = null\n        }\n    }, [])\n\n    const setupEscapeKey = useCallback(() => {\n        if (useNativeDialog) return\n        if (cleanupEscapeKeyRef.current) return\n        if (config?.closeExplicitly) return\n\n        cleanupEscapeKeyRef.current = onEscapeKey(() => {\n            if (modalContext.onTopOfStack) {\n                modalContext.close()\n            }\n        })\n    }, [config?.closeExplicitly, modalContext, useNativeDialog])\n\n    const cleanupEscapeKey = useCallback(() => {\n        if (cleanupEscapeKeyRef.current) {\n            cleanupEscapeKeyRef.current()\n            cleanupEscapeKeyRef.current = null\n        }\n    }, [])\n\n    const handleClickOutside = useCallback(\n        (event: MouseEvent) => {\n            if (useNativeDialog) return\n            if (!modalContext.onTopOfStack) return\n            if (config?.closeExplicitly) return\n            if (config?.closeOnClickOutside === false) return\n            if (!wrapperRef.current) return\n\n            if (!wrapperRef.current.contains(event.target as Node)) {\n                modalContext.close()\n            }\n        },\n        [modalContext, config?.closeExplicitly, config?.closeOnClickOutside, useNativeDialog],\n    )\n\n    // ============ Native dialog handlers ============\n\n    const handleCancel = useCallback(\n        (event: SyntheticEvent) => {\n            event.preventDefault()\n            if (modalContext.onTopOfStack && !config?.closeExplicitly) {\n                modalContext.close()\n            }\n        },\n        [modalContext, config?.closeExplicitly],\n    )\n\n    const handleDialogClick = useCallback(\n        (event: MouseEvent) => {\n            if (event.target === dialogRef.current) {\n                if (modalContext.onTopOfStack && !config?.closeExplicitly && config?.closeOnClickOutside !== false) {\n                    modalContext.close()\n                }\n            }\n        },\n        [modalContext, config?.closeExplicitly, config?.closeOnClickOutside],\n    )\n\n    const openDialog = useCallback(() => {\n        if (dialogRef.current && !dialogRef.current.open) {\n            dialogRef.current.showModal()\n            requestAnimationFrame(() => {\n                requestAnimationFrame(() => {\n                    setEntered(true)\n                })\n            })\n        }\n    }, [])\n\n    const closeDialog = useCallback(() => {\n        if (dialogRef.current && dialogRef.current.open) {\n            setIsLeaving(true)\n            setEntered(false)\n            setTimeout(() => {\n                if (dialogRef.current) {\n                    dialogRef.current.close()\n                }\n                setIsLeaving(false)\n                onAfterLeave?.()\n                modalContext.afterLeave()\n            }, 300)\n        }\n    }, [onAfterLeave, modalContext])\n\n    // ============ Lifecycle ============\n\n    // Initial mount\n    useEffect(() => {\n        if (useNativeDialog) {\n            if (modalContext.isOpen) {\n                openDialog()\n            }\n        } else {\n            setupEscapeKey()\n        }\n        return () => {\n            if (useNativeDialog) {\n                if (dialogRef.current?.open) {\n                    dialogRef.current.close()\n                }\n            } else {\n                cleanupFocusTrap()\n                cleanupEscapeKey()\n            }\n        }\n    }, [])\n\n    // Handle becoming top of stack / losing top of stack (non-native only)\n    useEffect(() => {\n        if (useNativeDialog) return\n\n        if (modalContext.onTopOfStack) {\n            setupEscapeKey()\n            if (entered) {\n                setupFocusTrap()\n            }\n        } else {\n            cleanupFocusTrap()\n            cleanupEscapeKey()\n        }\n    }, [modalContext.onTopOfStack, entered, setupEscapeKey, setupFocusTrap, cleanupFocusTrap, cleanupEscapeKey, useNativeDialog])\n\n    // Handle enter animation (non-native only)\n    useEffect(() => {\n        if (useNativeDialog) return\n\n        if (initialRender.current && modalContext.isOpen) {\n            initialRender.current = false\n            requestAnimationFrame(() => {\n                requestAnimationFrame(() => {\n                    setTransitionState('entered')\n                    setTimeout(() => {\n                        setEntered(true)\n                        setupFocusTrap()\n                    }, 300)\n                })\n            })\n        }\n    }, [modalContext.isOpen, setupFocusTrap, useNativeDialog])\n\n    // Handle leave animation (non-native only)\n    useEffect(() => {\n        if (useNativeDialog) return\n\n        if (!modalContext.isOpen && transitionState === 'entered') {\n            setTransitionState('leaving')\n            setTimeout(() => {\n                setTransitionState('exited')\n                onAfterLeave?.()\n                modalContext.afterLeave()\n            }, 300)\n        }\n    }, [modalContext.isOpen, transitionState, onAfterLeave, modalContext, useNativeDialog])\n\n    // Watch for open state changes (native only)\n    useEffect(() => {\n        if (!useNativeDialog) return\n\n        if (modalContext.isOpen) {\n            openDialog()\n        } else if (!isLeaving) {\n            closeDialog()\n        }\n    }, [modalContext.isOpen, openDialog, closeDialog, isLeaving, useNativeDialog])\n\n    // ============ Render ============\n\n    const renderContent = () => (\n        <div\n            className={`im-modal-content relative ${config.paddingClasses} ${config.panelClasses}`}\n            data-inertiaui-modal-entered={entered}\n        >\n            {config.closeButton && (\n                <div className=\"absolute right-0 top-0 pr-3 pt-3\">\n                    <CloseButton onClick={modalContext.close} />\n                </div>\n            )}\n            {typeof children === 'function' ? children({ modalContext, config }) : children}\n        </div>\n    )\n\n    // Native dialog mode\n    if (useNativeDialog) {\n        return (\n            <dialog\n                ref={dialogRef}\n                className={clsx(\n                    'im-modal-dialog m-0 overflow-visible bg-transparent p-0',\n                    'size-full max-h-none max-w-none',\n                    'backdrop:bg-black/75 backdrop:transition-opacity backdrop:duration-300',\n                    entered ? 'backdrop:opacity-100' : 'backdrop:opacity-0',\n                    !isFirstModal && 'backdrop:bg-transparent',\n                )}\n                onCancel={handleCancel}\n                onClick={handleDialogClick}\n            >\n                <div className=\"im-modal-container fixed inset-0 overflow-y-auto p-4\">\n                    <div\n                        className={clsx('im-modal-positioner flex min-h-full justify-center', {\n                            'items-start': config.position === 'top',\n                            'items-center': config.position === 'center',\n                            'items-end': config.position === 'bottom',\n                        })}\n                    >\n                        <div\n                            className={clsx(\n                                'im-modal-wrapper w-full transition duration-300 ease-in-out',\n                                modalContext.onTopOfStack ? '' : 'blur-xs',\n                                entered && !isLeaving ? 'translate-y-0 opacity-100 sm:scale-100' : 'translate-y-4 opacity-0 sm:translate-y-0 sm:scale-95',\n                                maxWidthClass,\n                            )}\n                        >\n                            {renderContent()}\n                        </div>\n                    </div>\n                </div>\n            </dialog>\n        )\n    }\n\n    // Non-native dialog mode\n    if (transitionState === 'exited') return null\n\n    const isEntering = transitionState === 'entering'\n    const isLeavingNonNative = transitionState === 'leaving'\n\n    return (\n        <div\n            className=\"im-modal-container fixed inset-0 z-40 overflow-y-auto p-4\"\n            onMouseDown={handleClickOutside}\n        >\n            <div\n                className={clsx('im-modal-positioner flex min-h-full justify-center', {\n                    'items-start': config.position === 'top',\n                    'items-center': config.position === 'center',\n                    'items-end': config.position === 'bottom',\n                })}\n                onMouseDown={handleClickOutside}\n            >\n                <div\n                    ref={wrapperRef}\n                    role=\"dialog\"\n                    aria-modal=\"true\"\n                    className={clsx(\n                        'im-modal-wrapper w-full transition duration-300 ease-in-out',\n                        modalContext.onTopOfStack ? '' : 'blur-xs',\n                        isEntering || isLeavingNonNative ? 'translate-y-4 opacity-0 sm:translate-y-0 sm:scale-95' : 'translate-y-0 opacity-100 sm:scale-100',\n                        maxWidthClass,\n                    )}\n                >\n                    <span className=\"sr-only\">Dialog</span>\n                    {renderContent()}\n                </div>\n            </div>\n        </div>\n    )\n}\n\nexport default ModalContent\n","import { useState, useEffect, useRef, useCallback, useMemo, ReactNode, SyntheticEvent, MouseEvent } from 'react'\nimport CloseButton from './CloseButton'\nimport clsx from 'clsx'\nimport { createFocusTrap, onEscapeKey } from '../../vue/src/dialog'\nimport { getMaxWidthClass } from '../../vue/src/constants'\nimport type { Modal } from './types'\n\ninterface SlideoverContentConfig {\n    maxWidth: string\n    paddingClasses: string\n    panelClasses: string\n    position: string\n    closeButton: boolean\n    closeExplicitly?: boolean\n    closeOnClickOutside?: boolean\n}\n\ninterface SlideoverContentProps {\n    modalContext: Modal\n    config: SlideoverContentConfig\n    useNativeDialog: boolean\n    isFirstModal: boolean\n    onAfterLeave?: () => void\n    children: ReactNode | ((props: { modalContext: Modal; config: SlideoverContentConfig }) => ReactNode)\n}\n\nconst SlideoverContent = ({ modalContext, config, useNativeDialog, isFirstModal, onAfterLeave, children }: SlideoverContentProps) => {\n    const [entered, setEntered] = useState(false)\n    const [isLeaving, setIsLeaving] = useState(false)\n    const [transitionState, setTransitionState] = useState<'entering' | 'entered' | 'leaving' | 'exited'>('entering')\n    const wrapperRef = useRef<HTMLDivElement>(null)\n    const dialogRef = useRef<HTMLDialogElement>(null)\n    const cleanupFocusTrapRef = useRef<(() => void) | null>(null)\n    const cleanupEscapeKeyRef = useRef<(() => void) | null>(null)\n    const initialRender = useRef(true)\n\n    const isLeft = config.position === 'left'\n\n    const maxWidthClass = useMemo(() => getMaxWidthClass(config.maxWidth), [config.maxWidth])\n\n    // Transform classes for slideover animation\n    const getTransformClass = useCallback(\n        (isHidden: boolean) => {\n            if (isHidden) {\n                return isLeft ? '-translate-x-full opacity-0' : 'translate-x-full opacity-0'\n            }\n            return 'translate-x-0 opacity-100'\n        },\n        [isLeft],\n    )\n\n    // ============ Non-native dialog handlers ============\n\n    const setupFocusTrap = useCallback(() => {\n        if (useNativeDialog) return\n        if (!wrapperRef.current || !modalContext.onTopOfStack) return\n        if (cleanupFocusTrapRef.current) return\n\n        cleanupFocusTrapRef.current = createFocusTrap(wrapperRef.current, {\n            initialFocus: true,\n            returnFocus: false,\n        })\n    }, [modalContext.onTopOfStack, useNativeDialog])\n\n    const cleanupFocusTrap = useCallback(() => {\n        if (cleanupFocusTrapRef.current) {\n            cleanupFocusTrapRef.current()\n            cleanupFocusTrapRef.current = null\n        }\n    }, [])\n\n    const setupEscapeKey = useCallback(() => {\n        if (useNativeDialog) return\n        if (cleanupEscapeKeyRef.current) return\n        if (config?.closeExplicitly) return\n\n        cleanupEscapeKeyRef.current = onEscapeKey(() => {\n            if (modalContext.onTopOfStack) {\n                modalContext.close()\n            }\n        })\n    }, [config?.closeExplicitly, modalContext, useNativeDialog])\n\n    const cleanupEscapeKey = useCallback(() => {\n        if (cleanupEscapeKeyRef.current) {\n            cleanupEscapeKeyRef.current()\n            cleanupEscapeKeyRef.current = null\n        }\n    }, [])\n\n    const handleClickOutside = useCallback(\n        (event: MouseEvent) => {\n            if (useNativeDialog) return\n            if (!modalContext.onTopOfStack) return\n            if (config?.closeExplicitly) return\n            if (config?.closeOnClickOutside === false) return\n            if (!wrapperRef.current) return\n\n            if (!wrapperRef.current.contains(event.target as Node)) {\n                modalContext.close()\n            }\n        },\n        [modalContext, config?.closeExplicitly, config?.closeOnClickOutside, useNativeDialog],\n    )\n\n    // ============ Native dialog handlers ============\n\n    const handleCancel = useCallback(\n        (event: SyntheticEvent) => {\n            event.preventDefault()\n            if (modalContext.onTopOfStack && !config?.closeExplicitly) {\n                modalContext.close()\n            }\n        },\n        [modalContext, config?.closeExplicitly],\n    )\n\n    const handleDialogClick = useCallback(\n        (event: MouseEvent) => {\n            if (event.target === dialogRef.current) {\n                if (modalContext.onTopOfStack && !config?.closeExplicitly && config?.closeOnClickOutside !== false) {\n                    modalContext.close()\n                }\n            }\n        },\n        [modalContext, config?.closeExplicitly, config?.closeOnClickOutside],\n    )\n\n    const openDialog = useCallback(() => {\n        if (dialogRef.current && !dialogRef.current.open) {\n            dialogRef.current.showModal()\n            requestAnimationFrame(() => {\n                requestAnimationFrame(() => {\n                    setEntered(true)\n                })\n            })\n        }\n    }, [])\n\n    const closeDialog = useCallback(() => {\n        if (dialogRef.current && dialogRef.current.open) {\n            setIsLeaving(true)\n            setEntered(false)\n            setTimeout(() => {\n                if (dialogRef.current) {\n                    dialogRef.current.close()\n                }\n                setIsLeaving(false)\n                onAfterLeave?.()\n                modalContext.afterLeave()\n            }, 300)\n        }\n    }, [onAfterLeave, modalContext])\n\n    // ============ Lifecycle ============\n\n    // Initial mount\n    useEffect(() => {\n        if (useNativeDialog) {\n            if (modalContext.isOpen) {\n                openDialog()\n            }\n        } else {\n            setupEscapeKey()\n        }\n        return () => {\n            if (useNativeDialog) {\n                if (dialogRef.current?.open) {\n                    dialogRef.current.close()\n                }\n            } else {\n                cleanupFocusTrap()\n                cleanupEscapeKey()\n            }\n        }\n    }, [])\n\n    // Handle becoming top of stack / losing top of stack (non-native only)\n    useEffect(() => {\n        if (useNativeDialog) return\n\n        if (modalContext.onTopOfStack) {\n            setupEscapeKey()\n            if (entered) {\n                setupFocusTrap()\n            }\n        } else {\n            cleanupFocusTrap()\n            cleanupEscapeKey()\n        }\n    }, [modalContext.onTopOfStack, entered, setupEscapeKey, setupFocusTrap, cleanupFocusTrap, cleanupEscapeKey, useNativeDialog])\n\n    // Handle enter animation (non-native only)\n    useEffect(() => {\n        if (useNativeDialog) return\n\n        if (initialRender.current && modalContext.isOpen) {\n            initialRender.current = false\n            requestAnimationFrame(() => {\n                requestAnimationFrame(() => {\n                    setTransitionState('entered')\n                    setTimeout(() => {\n                        setEntered(true)\n                        setupFocusTrap()\n                    }, 300)\n                })\n            })\n        }\n    }, [modalContext.isOpen, setupFocusTrap, useNativeDialog])\n\n    // Handle leave animation (non-native only)\n    useEffect(() => {\n        if (useNativeDialog) return\n\n        if (!modalContext.isOpen && transitionState === 'entered') {\n            setTransitionState('leaving')\n            setTimeout(() => {\n                setTransitionState('exited')\n                onAfterLeave?.()\n                modalContext.afterLeave()\n            }, 300)\n        }\n    }, [modalContext.isOpen, transitionState, onAfterLeave, modalContext, useNativeDialog])\n\n    // Watch for open state changes (native only)\n    useEffect(() => {\n        if (!useNativeDialog) return\n\n        if (modalContext.isOpen) {\n            openDialog()\n        } else if (!isLeaving) {\n            closeDialog()\n        }\n    }, [modalContext.isOpen, openDialog, closeDialog, isLeaving, useNativeDialog])\n\n    // ============ Render ============\n\n    const renderContent = () => (\n        <div\n            className={`im-slideover-content relative ${config.paddingClasses} ${config.panelClasses}`}\n            data-inertiaui-modal-entered={entered}\n        >\n            {config.closeButton && (\n                <div className=\"absolute right-0 top-0 pr-3 pt-3\">\n                    <CloseButton onClick={modalContext.close} />\n                </div>\n            )}\n            {typeof children === 'function' ? children({ modalContext, config }) : children}\n        </div>\n    )\n\n    // Native dialog mode\n    if (useNativeDialog) {\n        return (\n            <dialog\n                ref={dialogRef}\n                className={clsx(\n                    'im-slideover-dialog m-0 overflow-visible bg-transparent p-0',\n                    'size-full max-h-none max-w-none',\n                    'backdrop:bg-black/75 backdrop:transition-opacity backdrop:duration-300',\n                    entered ? 'backdrop:opacity-100' : 'backdrop:opacity-0',\n                    !isFirstModal && 'backdrop:bg-transparent',\n                )}\n                onCancel={handleCancel}\n                onClick={handleDialogClick}\n            >\n                <div className=\"im-slideover-container fixed inset-0 overflow-y-auto overflow-x-hidden\">\n                    <div\n                        className={clsx('im-slideover-positioner flex min-h-full items-center', {\n                            'justify-start rtl:justify-end': config?.position === 'left',\n                            'justify-end rtl:justify-start': config?.position === 'right',\n                        })}\n                    >\n                        <div\n                            className={clsx(\n                                'im-slideover-wrapper w-full transition duration-300 ease-in-out',\n                                modalContext.onTopOfStack ? '' : 'blur-xs',\n                                getTransformClass(!(entered && !isLeaving)),\n                                maxWidthClass,\n                            )}\n                        >\n                            {renderContent()}\n                        </div>\n                    </div>\n                </div>\n            </dialog>\n        )\n    }\n\n    // Non-native dialog mode\n    if (transitionState === 'exited') return null\n\n    const isEntering = transitionState === 'entering'\n    const isLeavingNonNative = transitionState === 'leaving'\n\n    return (\n        <div\n            className=\"im-slideover-container fixed inset-0 z-40 overflow-y-auto overflow-x-hidden\"\n            onMouseDown={handleClickOutside}\n        >\n            <div\n                className={clsx('im-slideover-positioner flex min-h-full items-center', {\n                    'justify-start rtl:justify-end': config?.position === 'left',\n                    'justify-end rtl:justify-start': config?.position === 'right',\n                })}\n                onMouseDown={handleClickOutside}\n            >\n                <div\n                    ref={wrapperRef}\n                    role=\"dialog\"\n                    aria-modal=\"true\"\n                    className={clsx(\n                        'im-slideover-wrapper w-full transition duration-300 ease-in-out',\n                        modalContext.onTopOfStack ? '' : 'blur-xs',\n                        getTransformClass(isEntering || isLeavingNonNative),\n                        maxWidthClass,\n                    )}\n                >\n                    <span className=\"sr-only\">Dialog</span>\n                    {renderContent()}\n                </div>\n            </div>\n        </div>\n    )\n}\n\nexport default SlideoverContent\n","import { forwardRef, useRef, useImperativeHandle, useState, useEffect, useCallback, useMemo, ReactNode } from 'react'\nimport { createPortal } from 'react-dom'\nimport HeadlessModal, { HeadlessModalRef } from './HeadlessModal'\nimport ModalContent from './ModalContent'\nimport SlideoverContent from './SlideoverContent'\nimport { lockScroll, markAriaHidden } from '../../vue/src/dialog'\nimport { getConfig } from './config'\nimport type { Modal as ModalType, ReloadOptions } from './types'\n\ninterface ModalConfig {\n    slideover: boolean\n    closeButton: boolean\n    closeExplicitly: boolean\n    maxWidth: string\n    paddingClasses: string\n    panelClasses: string\n    position: string\n}\n\ninterface ModalRenderProps {\n    afterLeave: () => void\n    close: () => void\n    config: ModalConfig\n    emit: (event: string, ...args: unknown[]) => void\n    getChildModal: () => ModalType | null\n    getParentModal: () => ModalType | null\n    id: string\n    index: number\n    isOpen: boolean\n    modalContext: ModalType\n    onTopOfStack: boolean\n    reload: (options?: ReloadOptions) => void\n    setOpen: (open: boolean) => void\n    shouldRender: boolean\n    // Allow additional props from visitModal\n    [key: string]: unknown\n}\n\ninterface ModalBaseProps {\n    name?: string\n    children: ReactNode | ((props: ModalRenderProps) => ReactNode)\n    onFocus?: () => void\n    onBlur?: () => void\n    onClose?: () => void\n    onSuccess?: () => void\n    onAfterLeave?: () => void\n    slideover?: boolean\n    closeButton?: boolean\n    closeExplicitly?: boolean\n    maxWidth?: string\n    paddingClasses?: string\n    panelClasses?: string\n    position?: string\n}\n\ntype ModalProps = ModalBaseProps & Record<string, unknown>\n\ninterface BackdropTransitionProps {\n    show: boolean\n    appear: boolean\n    onAfterAppear?: () => void\n}\n\nconst Modal = forwardRef<HeadlessModalRef, ModalProps>(\n    (allProps, ref) => {\n        const { name, children, onFocus, onBlur, onClose, onSuccess, onAfterLeave, ...props } = allProps as ModalBaseProps & Record<string, unknown>\n        const renderChildren = (contentProps: ModalRenderProps) => {\n            if (typeof children === 'function') {\n                return children(contentProps)\n            }\n\n            return children\n        }\n\n        const headlessModalRef = useRef<HeadlessModalRef>(null)\n        const cleanupScrollLockRef = useRef<(() => void) | null>(null)\n        const cleanupAriaHiddenRef = useRef<(() => void) | null>(null)\n        const [rendered, setRendered] = useState(false)\n        const useNativeDialog = useMemo(() => getConfig('useNativeDialog') as boolean, [])\n\n        useImperativeHandle(ref, () => headlessModalRef.current!, [headlessModalRef])\n\n        // Cleanup on unmount\n        useEffect(() => {\n            return () => {\n                cleanupScrollLockRef.current?.()\n                cleanupAriaHiddenRef.current?.()\n            }\n        }, [])\n\n        const handleSuccess = useCallback(() => {\n            onSuccess?.()\n            if (!cleanupScrollLockRef.current) {\n                cleanupScrollLockRef.current = lockScroll()\n                cleanupAriaHiddenRef.current = markAriaHidden('#app')\n            }\n        }, [onSuccess])\n\n        const handleClose = useCallback(() => {\n            onClose?.()\n            cleanupScrollLockRef.current?.()\n            cleanupAriaHiddenRef.current?.()\n            cleanupScrollLockRef.current = null\n            cleanupAriaHiddenRef.current = null\n        }, [onClose])\n\n        const handleAfterLeave = useCallback(() => {\n            onAfterLeave?.()\n        }, [onAfterLeave])\n\n        return (\n            <HeadlessModal\n                ref={headlessModalRef}\n                name={name}\n                onFocus={onFocus ?? undefined}\n                onBlur={onBlur ?? undefined}\n                onClose={handleClose}\n                onSuccess={handleSuccess}\n                {...props}\n            >\n                {({\n                    afterLeave,\n                    close,\n                    config,\n                    emit,\n                    getChildModal,\n                    getParentModal,\n                    id,\n                    index,\n                    isOpen,\n                    modalContext,\n                    onTopOfStack,\n                    reload,\n                    setOpen,\n                    shouldRender,\n                    ...extraProps\n                }) => (\n                    <ModalPortal>\n                        <div\n                            className=\"im-dialog relative z-20\"\n                            data-inertiaui-modal-id={id}\n                            data-inertiaui-modal-index={index}\n                            aria-hidden={!onTopOfStack}\n                        >\n                            {/* Only render backdrop for the first modal (non-native dialog mode) */}\n                            {/* Native dialog uses ::backdrop pseudo-element instead */}\n                            {index === 0 && !useNativeDialog && (\n                                <BackdropTransition\n                                    show={isOpen}\n                                    appear={!rendered}\n                                    onAfterAppear={() => setRendered(true)}\n                                />\n                            )}\n\n                            {/* The modal/slideover content itself */}\n                            {config.slideover ? (\n                                <SlideoverContent\n                                    modalContext={modalContext}\n                                    config={config}\n                                    useNativeDialog={useNativeDialog}\n                                    isFirstModal={index === 0}\n                                    onAfterLeave={handleAfterLeave}\n                                >\n                                    {renderChildren({\n                                        ...extraProps,\n                                        afterLeave,\n                                        close,\n                                        config,\n                                        emit,\n                                        getChildModal,\n                                        getParentModal,\n                                        id,\n                                        index,\n                                        isOpen,\n                                        modalContext,\n                                        onTopOfStack,\n                                        reload,\n                                        setOpen,\n                                        shouldRender,\n                                    })}\n                                </SlideoverContent>\n                            ) : (\n                                <ModalContent\n                                    modalContext={modalContext}\n                                    config={config}\n                                    useNativeDialog={useNativeDialog}\n                                    isFirstModal={index === 0}\n                                    onAfterLeave={handleAfterLeave}\n                                >\n                                    {renderChildren({\n                                        ...extraProps,\n                                        afterLeave,\n                                        close,\n                                        config,\n                                        emit,\n                                        getChildModal,\n                                        getParentModal,\n                                        id,\n                                        index,\n                                        isOpen,\n                                        modalContext,\n                                        onTopOfStack,\n                                        reload,\n                                        setOpen,\n                                        shouldRender,\n                                    })}\n                                </ModalContent>\n                            )}\n                        </div>\n                    </ModalPortal>\n                )}\n            </HeadlessModal>\n        )\n    },\n)\n\n// Simple portal component\nfunction ModalPortal({ children }: { children: ReactNode }) {\n    const [mounted, setMounted] = useState(false)\n\n    useEffect(() => {\n        setMounted(true)\n    }, [])\n\n    if (!mounted) return null\n\n    return createPortal(children, document.body)\n}\n\n// Backdrop with CSS transition\nfunction BackdropTransition({ show, appear, onAfterAppear }: BackdropTransitionProps) {\n    const [state, setState] = useState<'entering' | 'entered' | 'leaving' | 'exited'>(() => {\n        if (appear && show) return 'entering'\n        return show ? 'entered' : 'exited'\n    })\n    const initialRender = useRef(true)\n\n    useEffect(() => {\n        if (initialRender.current) {\n            initialRender.current = false\n            if (appear && show) {\n                requestAnimationFrame(() => {\n                    setState('entered')\n                    setTimeout(() => onAfterAppear?.(), 300)\n                })\n            }\n            return\n        }\n\n        if (show) {\n            setState('entering')\n            requestAnimationFrame(() => {\n                setState('entered')\n            })\n        } else {\n            setState('leaving')\n            setTimeout(() => setState('exited'), 300)\n        }\n    }, [show, appear, onAfterAppear])\n\n    if (state === 'exited') return null\n\n    const isVisible = state === 'entered'\n\n    return (\n        <div\n            className={`im-backdrop fixed inset-0 z-30 bg-black/75 transition-opacity duration-300 ease-in-out ${isVisible ? 'opacity-100' : 'opacity-0'}`}\n            aria-hidden=\"true\"\n        />\n    )\n}\n\nModal.displayName = 'Modal'\nexport default Modal\n","import { useCallback, useState, useEffect, useMemo, useRef, ReactNode, ElementType, MouseEvent } from 'react'\nimport { useModalStack, modalPropNames, prefetch as prefetchModal } from './ModalRoot'\nimport { only, rejectNullValues, isStandardDomEvent } from './helpers'\nimport { getConfig } from './config'\nimport type { Modal, PrefetchOption } from './types'\nimport type { RequestPayload } from '@inertiajs/core'\n\ninterface ModalLinkProps {\n    href: string\n    method?: string\n    data?: RequestPayload\n    as?: ElementType\n    headers?: Record<string, string>\n    queryStringArrayFormat?: 'brackets' | 'indices'\n    onAfterLeave?: () => void\n    onBlur?: () => void\n    onClose?: () => void\n    onError?: (error: unknown) => void\n    onFocus?: () => void\n    onStart?: () => void\n    onSuccess?: () => void\n    onPrefetching?: () => void\n    onPrefetched?: () => void\n    navigate?: boolean\n    // Prefetch options (#146)\n    prefetch?: PrefetchOption\n    cacheFor?: number\n    children: ReactNode | ((props: { loading: boolean }) => ReactNode)\n    [key: string]: unknown\n}\n\nconst ModalLink = ({\n    href,\n    method = 'get',\n    data = {} as RequestPayload,\n    as: Component = 'a',\n    headers = {},\n    queryStringArrayFormat = 'brackets' as const,\n    onAfterLeave,\n    onBlur,\n    onClose,\n    onError,\n    onFocus,\n    onStart,\n    onSuccess,\n    onPrefetching,\n    onPrefetched,\n    navigate,\n    prefetch = false,\n    cacheFor = 30000,\n    children,\n    ...props\n}: ModalLinkProps) => {\n    const [loading, setLoading] = useState(false)\n    const [modalContext, setModalContext] = useState<Modal | null>(null)\n    const { stack, visit } = useModalStack()\n    const hoverTimeout = useRef<ReturnType<typeof setTimeout> | null>(null)\n\n    const shouldNavigate = useMemo(() => {\n        return navigate ?? (getConfig('navigate') as boolean)\n    }, [navigate])\n\n    // Prefetch logic (#146)\n    const prefetchModes = useMemo(() => {\n        if (prefetch === true) {\n            return ['hover']\n        }\n        if (prefetch === false) {\n            return []\n        }\n        if (Array.isArray(prefetch)) {\n            return prefetch\n        }\n        return [prefetch]\n    }, [prefetch])\n\n    const doPrefetch = useCallback(() => {\n        prefetchModal(href, {\n            method,\n            data,\n            headers,\n            queryStringArrayFormat,\n            cacheFor,\n            onPrefetching: onPrefetching ?? undefined,\n            onPrefetched: onPrefetched ?? undefined,\n        })\n    }, [href, method, data, headers, queryStringArrayFormat, cacheFor, onPrefetching, onPrefetched])\n\n    const handleMouseEnter = useCallback(() => {\n        if (!prefetchModes.includes('hover')) return\n\n        hoverTimeout.current = setTimeout(() => {\n            doPrefetch()\n        }, 75) // Small delay to avoid prefetching on accidental hovers\n    }, [prefetchModes, doPrefetch])\n\n    const handleMouseLeave = useCallback(() => {\n        if (hoverTimeout.current) {\n            clearTimeout(hoverTimeout.current)\n            hoverTimeout.current = null\n        }\n    }, [])\n\n    const handleMouseDown = useCallback(\n        (event: MouseEvent) => {\n            if (!prefetchModes.includes('click')) return\n            if (event.button !== 0) return // Only left click\n\n            doPrefetch()\n        },\n        [prefetchModes, doPrefetch],\n    )\n\n    // Prefetch on mount\n    useEffect(() => {\n        if (prefetchModes.includes('mount')) {\n            doPrefetch()\n        }\n    }, [])\n\n    // Cleanup hover timeout on unmount\n    useEffect(() => {\n        return () => {\n            if (hoverTimeout.current) {\n                clearTimeout(hoverTimeout.current)\n            }\n        }\n    }, [])\n\n    // Separate standard props from custom event handlers\n    const standardProps: Record<string, unknown> = {}\n    const customEvents: Record<string, (...args: unknown[]) => void> = {}\n\n    Object.keys(props).forEach((key) => {\n        if (modalPropNames.includes(key)) {\n            return\n        }\n\n        if (key.startsWith('on') && typeof props[key] === 'function') {\n            if (isStandardDomEvent(key)) {\n                standardProps[key] = props[key]\n            } else {\n                customEvents[key] = props[key] as (...args: unknown[]) => void\n            }\n        } else {\n            standardProps[key] = props[key]\n        }\n    })\n\n    const [isBlurred, setIsBlurred] = useState(false)\n\n    useEffect(() => {\n        if (!modalContext) {\n            return\n        }\n\n        if (modalContext.onTopOfStack && isBlurred) {\n            onFocus?.()\n        } else if (!modalContext.onTopOfStack && !isBlurred) {\n            onBlur?.()\n        }\n\n        setIsBlurred(!modalContext.onTopOfStack)\n    }, [stack])\n\n    const onCloseCallback = useCallback(() => {\n        onClose?.()\n    }, [onClose])\n\n    const onAfterLeaveCallback = useCallback(() => {\n        setModalContext(null)\n        onAfterLeave?.()\n    }, [onAfterLeave])\n\n    const handle = useCallback(\n        (e?: MouseEvent) => {\n            e?.preventDefault()\n            if (loading) return\n\n            if (!href.startsWith('#')) {\n                setLoading(true)\n                onStart?.()\n            }\n\n            visit(\n                href,\n                method,\n                data,\n                headers,\n                rejectNullValues(only(props, modalPropNames)) as Record<string, unknown>,\n                () => onCloseCallback(),\n                onAfterLeaveCallback,\n                queryStringArrayFormat,\n                shouldNavigate,\n            )\n                .then((newModalContext) => {\n                    setModalContext(newModalContext)\n                    newModalContext.registerEventListenersFromProps(customEvents)\n                    onSuccess?.()\n                })\n                .catch((error) => {\n                    console.error(error)\n                    onError?.(error)\n                })\n                .finally(() => setLoading(false))\n        },\n        [href, method, data, headers, queryStringArrayFormat, props, onCloseCallback, onAfterLeaveCallback],\n    )\n\n    return (\n        <Component\n            {...standardProps}\n            href={href}\n            onClick={handle}\n            onMouseEnter={handleMouseEnter}\n            onMouseLeave={handleMouseLeave}\n            onMouseDown={handleMouseDown}\n        >\n            {typeof children === 'function' ? children({ loading }) : children}\n        </Component>\n    )\n}\n\nexport default ModalLink\n","// See: https://github.com/inertiajs/inertia/blob/48bcd21fb7daf467d0df1bfde2408f161f94a579/packages/react/src/WhenVisible.ts\nimport { createElement, useCallback, useEffect, useRef, useState, ReactNode, ElementType } from 'react'\nimport useModal from './useModal'\nimport type { ReloadOptions } from './types'\n\ninterface WhenVisibleProps {\n    children: ReactNode\n    data?: string | string[]\n    params?: ReloadOptions\n    buffer?: number\n    as?: ElementType\n    always?: boolean\n    fallback?: ReactNode\n}\n\nconst WhenVisible = ({ children, data, params, buffer, as, always, fallback }: WhenVisibleProps) => {\n    always = always ?? false\n    as = as ?? 'div'\n    fallback = fallback ?? null\n\n    const [loaded, setLoaded] = useState(false)\n    const hasFetched = useRef(false)\n    const fetching = useRef(false)\n    const ref = useRef<HTMLElement>(null)\n\n    const modal = useModal()\n\n    const getReloadParams = useCallback((): ReloadOptions => {\n        if (data) {\n            return {\n                only: Array.isArray(data) ? data : [data],\n            }\n        }\n\n        if (!params) {\n            throw new Error('You must provide either a `data` or `params` prop.')\n        }\n\n        return params\n    }, [params, data])\n\n    useEffect(() => {\n        if (!ref.current) {\n            return\n        }\n\n        const observer = new IntersectionObserver(\n            (entries) => {\n                if (!entries[0].isIntersecting) {\n                    return\n                }\n\n                if (!always && hasFetched.current) {\n                    observer.disconnect()\n                }\n\n                if (fetching.current) {\n                    return\n                }\n\n                hasFetched.current = true\n                fetching.current = true\n\n                const reloadParams = getReloadParams()\n\n                modal?.reload({\n                    ...reloadParams,\n                    onStart: () => {\n                        fetching.current = true\n                        reloadParams.onStart?.()\n                    },\n                    onFinish: () => {\n                        setLoaded(true)\n                        fetching.current = false\n                        reloadParams.onFinish?.()\n\n                        if (!always) {\n                            observer.disconnect()\n                        }\n                    },\n                })\n            },\n            {\n                rootMargin: `${buffer || 0}px`,\n            },\n        )\n\n        observer.observe(ref.current)\n\n        return () => {\n            observer.disconnect()\n        }\n    }, [ref, getReloadParams, buffer])\n\n    if (always || !loaded) {\n        return createElement(\n            as,\n            {\n                props: null,\n                ref,\n            },\n            loaded ? children : fallback,\n        )\n    }\n\n    return loaded ? children : null\n}\n\nWhenVisible.displayName = 'InertiaWhenVisible'\n\nexport default WhenVisible\n","import { createElement } from 'react'\nimport { getConfig, putConfig, resetConfig } from './config'\nimport { useModalIndex } from './ModalRenderer'\nimport { useModalStack, ModalRoot, ModalStackProvider, renderApp, initFromPageProps, modalPropNames, prefetch } from './ModalRoot'\nimport useModal from './useModal'\nimport Deferred from './Deferred'\nimport HeadlessModal from './HeadlessModal'\nimport Modal from './Modal'\nimport ModalLink from './ModalLink'\nimport WhenVisible from './WhenVisible'\nimport * as dialogUtils from '../../vue/src/dialog'\n\n// Types\nexport type {\n    Modal as ModalInstance,\n    ModalConfig,\n    ModalResponseData,\n    ModalStackContextValue,\n    VisitOptions,\n    ReloadOptions,\n    EventCallback,\n    ComponentResolver,\n    PageProps,\n    ModalRootProps,\n    ModalRendererProps,\n    LocalModal,\n    // Prefetch types (#146)\n    PrefetchOption,\n    PrefetchOptions,\n} from './types'\n\nexport type {\n    CleanupFunction,\n    FocusTrapOptions,\n    ClickOutsideOptions,\n    EscapeKeyOptions,\n    DialogOptions,\n    Dialog,\n} from '@inertiaui/vanilla'\n\nconst setPageLayout = <T extends { default: { layout?: (page: React.ReactNode) => React.ReactNode } }>(\n    layout: React.ComponentType<{ children?: React.ReactNode }>,\n) => (module: T): T => {\n    module.default.layout = (page) => createElement(layout, { children: page })\n    return module\n}\n\nexport {\n    Deferred,\n    HeadlessModal,\n    Modal,\n    ModalLink,\n    ModalRoot,\n    ModalStackProvider,\n    WhenVisible,\n    getConfig,\n    initFromPageProps,\n    modalPropNames,\n    putConfig,\n    renderApp,\n    resetConfig,\n    setPageLayout,\n    useModal,\n    useModalIndex,\n    useModalStack,\n    // Prefetch function (#146)\n    prefetch,\n    // Dialog utilities (framework-agnostic)\n    dialogUtils,\n}\n"],"names":["defaultConfig","Config","key","value","keys","current","i","k","configInstance","resetConfig","putConfig","getConfig","getConfigByType","isSlideover","REACT_ELEMENT_TYPE","REACT_FRAGMENT_TYPE","jsxProd","type","config","maybeKey","propName","reactJsxRuntime_production","getComponentNameFromType","REACT_CLIENT_REFERENCE","REACT_PROFILER_TYPE","REACT_STRICT_MODE_TYPE","REACT_SUSPENSE_TYPE","REACT_SUSPENSE_LIST_TYPE","REACT_ACTIVITY_TYPE","REACT_PORTAL_TYPE","REACT_CONTEXT_TYPE","REACT_CONSUMER_TYPE","REACT_FORWARD_REF_TYPE","innerType","REACT_MEMO_TYPE","REACT_LAZY_TYPE","testStringCoercion","checkKeyStringCoercion","JSCompiler_inline_result","JSCompiler_temp_const","JSCompiler_inline_result$jscomp$0","getTaskName","name","getOwner","dispatcher","ReactSharedInternals","UnknownOwner","hasValidKey","hasOwnProperty","getter","defineKeyPropWarningGetter","props","displayName","warnAboutAccessingKey","specialPropKeyWarningShown","elementRefGetterWithDeprecationWarning","componentName","didWarnAboutElementRef","ReactElement","owner","debugStack","debugTask","refProp","jsxDEVImpl","isStaticChildren","children","isArrayImpl","validateChildKeys","didWarnAboutKeySpread","node","isValidElement","object","React","require$$0","createTask","callStackForError","unknownOwnerDebugStack","unknownOwnerDebugTask","reactJsxRuntime_development","trackActualOwner","jsxRuntimeModule","require$$1","generateId","prefix","vanillaGenerateId","sameUrlPath","url1","url2","origin","parsed1","parsed2","ModalStackContext","createContext","pageVersion","resolveComponent","baseUrl","prefetchCache","prefetchInFlight","getPrefetchCacheKey","url","method","data","getCachedResponse","cached","setCachedResponse","response","cacheFor","prefetch","href","options","headers","queryStringArrayFormat","mergedData","mergeDataIntoQueryString","cacheKey","inFlight","_a","requestHeaders","request","Axios","ModalStackProvider","stackRef","useRef","forceUpdate","useReducer","x","localModals","setLocalModals","useState","updateStack","withStack","newStack","isOnTopOfStack","modalId","modal","index","m","ModalClass","component","onClose","afterLeave","prevStack","open","currentStack","modalClosed","event","updatedStack","router","currentProps","_inertiaui_modal","rest","callback","kebabCase","cb","args","unsubscribers","eventName","unsub","except","_b","error","isValidModalResponse","pushFromResponseData","responseData","onAfterLeave","push","loadDeferredProps","deferred","newModal","pushLocalModal","visitModal","visit","listeners","updateBrowserUrl","useBrowserHistory","modalData","payload","onStart","onSuccess","onError","resolve","reject","cachedResponse","progress","force","prevLocalModals","newLocalModals","jsx","useModalStack","context","useContext","modalPropNames","initFromPageProps","pageProps","renderApp","App","renderInertiaApp","Component","renderComponent","child","createElement","acc","Layout","jsxs","Fragment","ModalRoot","$page","usePage","pendingModalKeysRef","getModalKey","isNavigatingRef","initialModalStillOpenedRef","useEffect","$event","modalOnBase","pageUrl","modalKey","axiosRequestInterceptor","baseUrlValue","interceptorId","previousModalRef","previousModal","existingModal","ModalRenderer","ModalIndexContext","useModalIndex","stack","modalContext","useMemo","useModal","Deferred","fallback","loaded","setLoaded","modalProps","HeadlessModal","forwardRef","allProps","ref","onFocus","onBlur","modalIndex","registerLocalModal","removeLocalModal","localModalContext","setLocalModalContext","nextIndex","configSlideover","removeListeners","localContext","modalContextRef","previousIsOpenRef","rendered","setRendered","useImperativeHandle","CloseButton","onClick","r","e","t","f","n","o","clsx","maxWidthClasses","defaultMaxWidth","getMaxWidthClass","maxWidth","ModalContent","useNativeDialog","isFirstModal","entered","setEntered","isLeaving","setIsLeaving","transitionState","setTransitionState","wrapperRef","dialogRef","cleanupFocusTrapRef","cleanupEscapeKeyRef","initialRender","maxWidthClass","setupFocusTrap","useCallback","createFocusTrap","cleanupFocusTrap","setupEscapeKey","onEscapeKey","cleanupEscapeKey","handleClickOutside","handleCancel","handleDialogClick","openDialog","closeDialog","renderContent","isEntering","isLeavingNonNative","SlideoverContent","isLeft","getTransformClass","isHidden","Modal","renderChildren","contentProps","headlessModalRef","cleanupScrollLockRef","cleanupAriaHiddenRef","handleSuccess","lockScroll","markAriaHidden","handleClose","handleAfterLeave","close","emit","getChildModal","getParentModal","id","isOpen","onTopOfStack","reload","setOpen","shouldRender","extraProps","ModalPortal","BackdropTransition","mounted","setMounted","createPortal","show","appear","onAfterAppear","state","setState","isVisible","ModalLink","onPrefetching","onPrefetched","navigate","loading","setLoading","setModalContext","hoverTimeout","shouldNavigate","prefetchModes","doPrefetch","prefetchModal","handleMouseEnter","handleMouseLeave","handleMouseDown","standardProps","customEvents","isStandardDomEvent","isBlurred","setIsBlurred","onCloseCallback","onAfterLeaveCallback","handle","rejectNullValues","only","newModalContext","WhenVisible","params","buffer","as","always","hasFetched","fetching","getReloadParams","observer","entries","reloadParams","setPageLayout","layout","module","page"],"mappings":"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","x_google_ignoreList":[1,2,3,11]}